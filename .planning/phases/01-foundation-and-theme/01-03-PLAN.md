---
phase: 01-foundation-and-theme
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - app/_layout.tsx
  - app/index.tsx
  - app/workout.tsx
  - app/template-editor.tsx
  - app/sign-in.tsx
  - app/create-account.tsx
  - app/settings/exercises.tsx
  - app/settings/history.tsx
  - app/settings/[exerciseId].tsx
autonomous: false

must_haves:
  truths:
    - "App launches in Expo Go on physical iPhone and renders dashboard placeholder with dark theme"
    - "Theme tokens are visible on screen (correct background color #0f0f0f, text color #ffffff)"
    - "Every placeholder screen has a 44px-tall pressable element"
    - "Navigation works: can navigate from dashboard to workout, template-editor, settings screens"
    - "Stack.Protected separates auth screens (sign-in, create-account) from app screens"
    - "Template editor presents as modal (slides up from bottom)"
    - "Workout screen has gesture disabled (no swipe-back)"
    - "Supabase client initializes without error (connection test passes in console)"
  artifacts:
    - path: "app/_layout.tsx"
      provides: "Root layout with ThemeProvider and Stack.Protected"
      contains: "Stack.Protected"
      min_lines: 25
    - path: "app/index.tsx"
      provides: "Dashboard placeholder screen"
      contains: "useTheme"
    - path: "app/workout.tsx"
      provides: "Workout placeholder screen"
      contains: "useTheme"
    - path: "app/template-editor.tsx"
      provides: "Template editor placeholder screen"
      contains: "useTheme"
    - path: "app/sign-in.tsx"
      provides: "Sign-in placeholder screen"
      contains: "useTheme"
    - path: "app/create-account.tsx"
      provides: "Create account placeholder screen"
      contains: "useTheme"
    - path: "app/settings/exercises.tsx"
      provides: "My Exercises placeholder screen"
      contains: "useTheme"
    - path: "app/settings/history.tsx"
      provides: "Exercise History placeholder screen"
      contains: "useTheme"
    - path: "app/settings/[exerciseId].tsx"
      provides: "Exercise Detail placeholder screen"
      contains: "useTheme"
  key_links:
    - from: "app/_layout.tsx"
      to: "@/theme"
      via: "imports ThemeProvider and useTheme"
      pattern: "from '@/theme'"
    - from: "app/_layout.tsx"
      to: "Stack.Protected"
      via: "auth guard for screen groups"
      pattern: "Stack\\.Protected.*guard"
    - from: "app/index.tsx"
      to: "@/theme"
      via: "style factory pattern with useTheme"
      pattern: "useTheme"
    - from: "app/_layout.tsx"
      to: "template-editor"
      via: "presentation: modal"
      pattern: "presentation.*modal"
    - from: "app/_layout.tsx"
      to: "workout"
      via: "gestureEnabled: false"
      pattern: "gestureEnabled.*false"
---

<objective>
Create the navigation skeleton with root layout (Stack.Protected for auth guard) and all placeholder screens using the theme system, then verify on physical device.

Purpose: Wire together the theme system and navigation structure to prove the entire Phase 1 substrate works end-to-end -- dark theme renders, navigation transitions work, tap targets meet 44px minimum, and Supabase client connects.

Output: Root layout with Stack.Protected, 9 placeholder screens (dashboard, workout, template-editor, sign-in, create-account, settings/exercises, settings/history, settings/[exerciseId]) all using the style factory pattern, plus human verification on physical iPhone.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-theme/01-RESEARCH.md
@.planning/phases/01-foundation-and-theme/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root layout and all placeholder screens</name>
  <files>app/_layout.tsx, app/index.tsx, app/workout.tsx, app/template-editor.tsx, app/sign-in.tsx, app/create-account.tsx, app/settings/exercises.tsx, app/settings/history.tsx, app/settings/[exerciseId].tsx</files>
  <action>
IMPORTANT: Delete any template-generated files in `app/` that are NOT in our target file list (e.g., `app/(tabs)/`, `app/+not-found.tsx`, `app/+html.tsx`, or any other files from the default Expo template). We are replacing the entire app/ directory structure with our own.

Also remove or clean up any template-generated component files in the project root or `components/` directory that came from the Expo template (like `components/ThemedText.tsx`, etc.) -- we do not use these.

**1. `app/_layout.tsx`** -- Root layout with ThemeProvider and Stack.Protected:

```typescript
import { Stack } from 'expo-router';
import { ThemeProvider, useTheme } from '@/theme';
import { supabase } from '@/lib/supabase';
import { useEffect } from 'react';

function RootLayoutNav() {
  const theme = useTheme();
  // Phase 1: hardcode to true -- Phase 2 will use real auth state
  const isLoggedIn = true;

  useEffect(() => {
    // Phase 1: Supabase connection test -- log result to console
    supabase.auth.getSession().then(({ error }) => {
      if (error) {
        console.error('Supabase connection test failed:', error.message);
      } else {
        console.log('Supabase connection successful');
      }
    });
  }, []);

  return (
    <Stack
      screenOptions={{
        headerShown: false,
        contentStyle: { backgroundColor: theme.colors.bgPrimary },
      }}
    >
      {/* Auth screens -- shown when NOT logged in */}
      <Stack.Protected guard={!isLoggedIn}>
        <Stack.Screen name="sign-in" />
        <Stack.Screen name="create-account" />
      </Stack.Protected>

      {/* App screens -- shown when logged in */}
      <Stack.Protected guard={isLoggedIn}>
        <Stack.Screen name="index" />
        <Stack.Screen
          name="template-editor"
          options={{ presentation: 'modal' }}
        />
        <Stack.Screen
          name="workout"
          options={{ gestureEnabled: false }}
        />
        <Stack.Screen name="settings" />
      </Stack.Protected>
    </Stack>
  );
}

export default function RootLayout() {
  return (
    <ThemeProvider>
      <RootLayoutNav />
    </ThemeProvider>
  );
}
```

Key points:
- ThemeProvider wraps the entire app
- RootLayoutNav is a separate component so useTheme() works (it needs to be inside ThemeProvider)
- `isLoggedIn = true` hardcoded for Phase 1 (auth screens hidden, app screens shown)
- Supabase connection test runs once on mount and logs to console
- Template editor: `presentation: 'modal'` (slides up)
- Workout: `gestureEnabled: false` (no swipe-back)
- All screens: `headerShown: false` (we will build custom headers later)
- `contentStyle: { backgroundColor: theme.colors.bgPrimary }` prevents white flash during transitions

**2. Create a settings layout file `app/settings/_layout.tsx`**:

```typescript
import { Stack } from 'expo-router';
import { useTheme } from '@/theme';

export default function SettingsLayout() {
  const theme = useTheme();
  return (
    <Stack
      screenOptions={{
        headerShown: false,
        contentStyle: { backgroundColor: theme.colors.bgPrimary },
      }}
    />
  );
}
```

**3. Create placeholder screens.** Each screen follows the same pattern:
- Uses `useTheme()` hook
- Uses style factory pattern: `createStyles(theme: Theme)` returning `StyleSheet.create()`
- Shows screen name as title text
- Shows a subtitle with route info
- Includes a 44px-tall Pressable element (demonstrates tap target compliance)
- Includes navigation links to related screens via `router.push()` or `router.back()`
- Uses SafeAreaView from react-native-safe-area-context for proper insets

Placeholder screen template (adapt for each screen):

```typescript
import { View, Text, Pressable, StyleSheet } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { useRouter } from 'expo-router';
import { useTheme, type Theme } from '@/theme';

function createStyles(theme: Theme) {
  return StyleSheet.create({
    container: {
      flex: 1,
      backgroundColor: theme.colors.bgPrimary,
    },
    content: {
      flex: 1,
      padding: theme.spacing.md,
      justifyContent: 'center',
      alignItems: 'center',
      gap: theme.spacing.md,
    },
    title: {
      color: theme.colors.textPrimary,
      fontSize: theme.typography.sizes['2xl'],
      fontWeight: theme.typography.weights.semibold,
    },
    subtitle: {
      color: theme.colors.textSecondary,
      fontSize: theme.typography.sizes.base,
    },
    button: {
      backgroundColor: theme.colors.accent,
      borderRadius: theme.radii.md,
      paddingHorizontal: theme.spacing.lg,
      minHeight: theme.layout.minTapTarget,
      justifyContent: 'center',
      alignItems: 'center',
    },
    buttonPressed: {
      backgroundColor: theme.colors.accentHover,
    },
    buttonText: {
      color: theme.colors.textPrimary,
      fontSize: theme.typography.sizes.base,
      fontWeight: theme.typography.weights.medium,
    },
  });
}

export default function ScreenName() {
  const theme = useTheme();
  const styles = createStyles(theme);
  const router = useRouter();

  return (
    <SafeAreaView style={styles.container}>
      <View style={styles.content}>
        <Text style={styles.title}>Screen Name</Text>
        <Text style={styles.subtitle}>Placeholder -- Phase 1</Text>
        <Pressable
          style={({ pressed }) => [styles.button, pressed && styles.buttonPressed]}
          onPress={() => router.push('/some-route')}
        >
          <Text style={styles.buttonText}>Navigate Somewhere</Text>
        </Pressable>
      </View>
    </SafeAreaView>
  );
}
```

Create these 8 screens with the template above, customized as follows:

| File | Title | Navigation Button |
|------|-------|-------------------|
| `app/index.tsx` | "Dashboard" | Three buttons: "Start Workout" -> /workout, "Edit Template" -> /template-editor, "Exercises" -> /settings/exercises |
| `app/workout.tsx` | "Active Workout" | "Back to Dashboard" -> router.back() |
| `app/template-editor.tsx` | "Template Editor" | "Close" -> router.back() |
| `app/sign-in.tsx` | "Sign In" | "Create Account" -> /create-account |
| `app/create-account.tsx` | "Create Account" | "Sign In" -> /sign-in |
| `app/settings/exercises.tsx` | "My Exercises" | "Back" -> router.back(), "View Exercise" -> /settings/test-exercise-id |
| `app/settings/history.tsx` | "Workout History" | "Back" -> router.back() |
| `app/settings/[exerciseId].tsx` | "Exercise Detail" | "Back" -> router.back() (use `useLocalSearchParams()` to get exerciseId and display it in subtitle) |

The dashboard (index.tsx) should have multiple navigation buttons to demonstrate the different navigation patterns (stack push, modal, etc.).

CRITICAL: Every Pressable must have `minHeight: theme.layout.minTapTarget` (44px) to satisfy UI-06.
  </action>
  <verify>
- `npx tsc --noEmit` has no TypeScript errors
- `app/_layout.tsx` contains Stack.Protected with guard conditions
- `app/_layout.tsx` contains `presentation: 'modal'` for template-editor
- `app/_layout.tsx` contains `gestureEnabled: false` for workout
- All 8 placeholder screens + 2 layouts exist in app/
- Every placeholder screen imports useTheme from '@/theme'
- Every Pressable has minHeight: theme.layout.minTapTarget
- No hardcoded color values in any screen file
- No files from the Expo default template remain (no tabs, no ThemedText)
  </verify>
  <done>Root layout with Stack.Protected auth guard, 8 placeholder screens using style factory pattern, all with 44px tap targets, dark theme colors from useTheme(), and navigation links between screens. Template editor as modal, workout with gesture disabled.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 1 foundation: Expo project with theme system, navigation skeleton, Supabase connection, and placeholder screens. All dark-themed, all using the style factory pattern, all with 44px tap targets.</what-built>
  <how-to-verify>
1. **Start the dev server:**
   ```bash
   cd C:\Users\MarioPC\Apps\ironlift
   npx expo start
   ```

2. **Open in Expo Go on iPhone:** Scan QR code with Camera app

3. **Verify dark theme:** Dashboard screen should have #0f0f0f background, white text, blue (#4f9eff) accent buttons

4. **Verify navigation:**
   - Tap "Start Workout" -> should push to Workout screen (no swipe-back gesture)
   - Tap "Back to Dashboard" -> returns to dashboard
   - Tap "Edit Template" -> should slide up as modal from bottom
   - Tap "Close" -> dismisses modal
   - Tap "Exercises" -> pushes to My Exercises screen
   - Tap "View Exercise" -> pushes to Exercise Detail screen with exercise ID in subtitle

5. **Verify tap targets:** All buttons should be visually comfortable to tap (44px minimum height)

6. **Verify Supabase connection:** Check Expo CLI terminal output for either:
   - "Supabase connection successful" (if .env has real credentials)
   - "Supabase connection test failed: ..." (if using placeholder .env -- this is expected and acceptable for Phase 1)
   - The important thing is that the Supabase client INITIALIZES without crashing the app

7. **Verify no template remnants:** No tab bar, no default Expo template screens, no "Welcome to Expo" content
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues you see</resume-signal>
</task>

</tasks>

<verification>
- App launches in Expo Go without crash
- All screens render with dark theme (#0f0f0f background)
- Navigation transitions work (push, modal, back)
- Template editor presents as modal
- Workout screen has no swipe-back gesture
- All buttons are 44px+ tall
- Supabase client initializes (logged to console)
- No Expo template remnants visible
- TypeScript compiles cleanly: `npx tsc --noEmit`
</verification>

<success_criteria>
Phase 1 success criteria (from roadmap):
1. App launches in Expo Go on physical iPhone and renders a placeholder screen with correct dark theme colors
2. Theme tokens (colors, spacing, radii, typography) are accessible via useTheme() hook and match the web app's CSS custom properties
3. All interactive elements meet the 44px minimum tap target
4. Navigation skeleton exists with Expo Router -- root layout, auth layout, and main layout are in place (even if screens are empty placeholders)
5. Supabase client initializes and connects successfully (verified by a test query or auth ping)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-theme/01-03-SUMMARY.md`
</output>
