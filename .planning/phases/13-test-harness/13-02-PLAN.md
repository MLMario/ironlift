---
phase: 13-test-harness
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - __tests__/helpers/render.tsx
  - __tests__/lib/formatters.test.ts
  - __tests__/lib/timeUtils.test.ts
  - __tests__/components/SubmitButton.test.tsx
autonomous: true

must_haves:
  truths:
    - "npm test runs all proof-of-concept tests and they pass"
    - "Pure utility functions are tested without mocks"
    - "Component renders correctly with ThemeProvider wrapper"
    - "@/* path alias imports resolve correctly in test files"
  artifacts:
    - path: "__tests__/helpers/render.tsx"
      provides: "Custom render helper with ThemeProvider wrapper"
      contains: "ThemeProvider"
    - path: "__tests__/lib/formatters.test.ts"
      provides: "Tests for formatVolume, formatWorkoutDate, formatDetailDate"
      contains: "formatVolume"
    - path: "__tests__/lib/timeUtils.test.ts"
      provides: "Tests for formatTime, parseTimeInput, clampSeconds"
      contains: "formatTime"
    - path: "__tests__/components/SubmitButton.test.tsx"
      provides: "Component render test using custom render helper"
      contains: "toBeOnTheScreen"
  key_links:
    - from: "__tests__/helpers/render.tsx"
      to: "src/theme/index.ts"
      via: "ThemeProvider import"
      pattern: "import.*ThemeProvider.*@/theme"
    - from: "__tests__/lib/formatters.test.ts"
      to: "src/lib/formatters.ts"
      via: "direct import of utility functions"
      pattern: "import.*@/lib/formatters"
    - from: "__tests__/components/SubmitButton.test.tsx"
      to: "__tests__/helpers/render.tsx"
      via: "custom render import"
      pattern: "import.*render.*helpers/render"
    - from: "__tests__/components/SubmitButton.test.tsx"
      to: "src/components/SubmitButton.tsx"
      via: "component under test import"
      pattern: "import.*SubmitButton.*@/components/SubmitButton"
---

<objective>
Create proof-of-concept tests that validate the test harness works end-to-end: pure utility tests, a custom render helper with ThemeProvider, and a component render test.

Purpose: Prove the test infrastructure from Plan 01 actually works by exercising the three main test patterns (pure function, service/util with mocks, component with context). These tests also serve as templates for future test writing.
Output: 4 passing tests across 3 test files, plus a reusable render helper.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-test-harness/13-RESEARCH.md
@.planning/phases/13-test-harness/13-01-SUMMARY.md
@src/lib/formatters.ts
@src/lib/timeUtils.ts
@src/components/SubmitButton.tsx
@src/theme/ThemeProvider.tsx
@src/theme/index.ts
@jest.config.ts
@jest-setup.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom render helper and pure utility tests</name>
  <files>__tests__/helpers/render.tsx, __tests__/lib/formatters.test.ts, __tests__/lib/timeUtils.test.ts</files>
  <action>
Create the `__tests__/` directory structure:
```
__tests__/
  helpers/
    render.tsx
  lib/
    formatters.test.ts
    timeUtils.test.ts
  components/
    (created in Task 2)
```

**__tests__/helpers/render.tsx** -- Custom render helper that wraps components with ThemeProvider:
- Import `render` and `RenderOptions` from `@testing-library/react-native`
- Import `ThemeProvider` from `@/theme`
- Create `AllProviders` wrapper component that wraps children in `<ThemeProvider>`
- Export a `customRender` function that calls RNTL's `render` with `{ wrapper: AllProviders }`
- Re-export everything from `@testing-library/react-native`
- Override the default `render` export with `customRender`
- Reference Pattern 5 from 13-RESEARCH.md

**__tests__/lib/formatters.test.ts** -- Tests for all three formatters functions:
- `formatVolume`: test values below 1000 (e.g., 750 -> "750"), exact thousands (1000 -> "1k"), decimal thousands (45200 -> "45.2k"), zero (0 -> "0")
- `formatWorkoutDate`: test with a known ISO date string, verify "Mon D" format output
- `formatDetailDate`: test with a known ISO date string, verify "Mon D, YYYY" format output
- Import from `@/lib/formatters` to verify the path alias works

**__tests__/lib/timeUtils.test.ts** -- Tests for all three time utility functions:
- `formatTime`: test 90 -> "1:30", 60 -> "1:00", 45 -> "0:45", 0 -> "0:00", negative -> "0:00"
- `parseTimeInput`: test "90" -> 90, "1:30" -> 90, ":30" -> 30, "1:" -> 60, "0" -> 0, "" -> null, "abc" -> null, " " -> null
- `clampSeconds`: test clamping below min, above max, within range
- Import from `@/lib/timeUtils` to verify the path alias works

IMPORTANT: These are pure function tests. They require NO mocks, NO React rendering. They exercise the test runner, module resolution, and path alias resolution.

Use `describe`/`it` (or `test`) blocks. Keep tests focused and readable -- these serve as templates for future test writing.
  </action>
  <verify>
Run `npx jest __tests__/lib/` and confirm all tests pass.
Verify the @/* path alias resolves correctly (tests import from @/lib/formatters and @/lib/timeUtils).
  </verify>
  <done>All pure utility tests pass. Path alias @/* resolves correctly in test files. Custom render helper is created and ready for component tests.</done>
</task>

<task type="auto">
  <name>Task 2: Create component render test</name>
  <files>__tests__/components/SubmitButton.test.tsx</files>
  <action>
Create **__tests__/components/SubmitButton.test.tsx** -- Component render test:
- Import `render` and `screen` from the custom helper (`../helpers/render` -- NOT from `@testing-library/react-native` directly) so ThemeProvider is auto-applied
- Import `SubmitButton` from `@/components/SubmitButton`
- Test that the button renders with its title text visible: `expect(screen.getByText('Save')).toBeOnTheScreen()`
- Test that loading state shows ActivityIndicator instead of text: render with `loading={true}`, verify the title text is NOT present using `screen.queryByText('Save')` returning null
- Use RNTL v13 built-in matchers (`toBeOnTheScreen`) -- do NOT import from `@testing-library/jest-native`

This test validates:
1. The custom render helper correctly wraps with ThemeProvider
2. RNTL renders the component and queries work
3. Global mocks from jest-setup.ts load correctly (Reanimated, Gesture Handler, etc.)
4. Built-in RNTL matchers work without separate package

After creating the test, run the full test suite: `npm test`

If any tests fail due to path alias issues, add `moduleNameMapper: { '^@/(.*)$': '<rootDir>/src/$1' }` to jest.config.ts as a fallback (per research Open Question 1).

If any tests fail due to missing mocks, add the necessary mocks to jest-setup.ts and document what was added.
  </action>
  <verify>
Run `npm test` and confirm ALL tests pass (both utility tests from Task 1 and component test from Task 2).
Verify test output shows correct number of test suites and tests.
  </verify>
  <done>All proof-of-concept tests pass: formatters (pure), timeUtils (pure), and SubmitButton (component with ThemeProvider). `npm test` exits with code 0.</done>
</task>

</tasks>

<verification>
1. `npm test` runs all test files and exits with code 0
2. Test output shows 3 test suites, all passing
3. No warnings about missing mocks or unresolved modules
4. @/* path alias resolves correctly in all test files
5. RNTL built-in matchers (toBeOnTheScreen) work without extra packages
</verification>

<success_criteria>
- __tests__/helpers/render.tsx provides a custom render with ThemeProvider
- __tests__/lib/formatters.test.ts tests all three formatter functions and passes
- __tests__/lib/timeUtils.test.ts tests all three time utility functions and passes
- __tests__/components/SubmitButton.test.tsx renders a component with ThemeProvider and uses toBeOnTheScreen matcher
- `npm test` runs all 3 test suites with 0 failures
- Path alias @/* works in test imports without manual moduleNameMapper
</success_criteria>

<output>
After completion, create `.planning/phases/13-test-harness/13-02-SUMMARY.md`
</output>
