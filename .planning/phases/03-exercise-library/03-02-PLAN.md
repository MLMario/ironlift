---
phase: 03-exercise-library
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/hooks/useExercises.ts
  - src/components/CategoryChips.tsx
  - src/components/ExerciseListItem.tsx
autonomous: true

must_haves:
  truths:
    - "useExercises hook loads exercises from cache first, then fetches fresh from Supabase"
    - "Exercises are sorted: user exercises first, then system exercises, alphabetical within each group"
    - "CategoryChips renders horizontal scrollable pills with single-select behavior"
    - "ExerciseListItem displays name (bold) + category (muted) with optional CUSTOM badge and disabled state"
  artifacts:
    - path: "src/hooks/useExercises.ts"
      provides: "Exercise data loading, caching, and refresh"
      exports: ["useExercises"]
    - path: "src/components/CategoryChips.tsx"
      provides: "Horizontal scrollable category filter chips"
      exports: ["CategoryChips", "CATEGORIES", "FORM_CATEGORIES"]
    - path: "src/components/ExerciseListItem.tsx"
      provides: "Single exercise row with name, category, badge, disabled state"
      exports: ["ExerciseListItem", "ITEM_HEIGHT"]
  key_links:
    - from: "src/hooks/useExercises.ts"
      to: "src/services/exercises.ts"
      via: "exercises.getExercises()"
      pattern: "exercises\\.getExercises"
    - from: "src/hooks/useExercises.ts"
      to: "src/lib/cache.ts"
      via: "getCachedExercises/setCachedExercises"
      pattern: "(getCachedExercises|setCachedExercises)"
    - from: "src/components/ExerciseListItem.tsx"
      to: "src/types/database.ts"
      via: "Exercise type"
      pattern: "import type.*Exercise.*from.*@/types/database"
---

<objective>
Create the useExercises data hook and the two reusable UI sub-components (CategoryChips, ExerciseListItem) that the picker modal will assemble.

Purpose: Separate data management from UI, and break the picker modal into composable parts that can be independently tested and reused.
Output: Three new files -- a data hook and two presentational components.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-exercise-library/03-CONTEXT.md
@.planning/phases/03-exercise-library/03-RESEARCH.md
@.planning/phases/03-exercise-library/03-01-SUMMARY.md
@src/types/database.ts
@src/types/services.ts
@src/theme/tokens.ts
@src/components/TextInputField.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useExercises data hook</name>
  <files>src/hooks/useExercises.ts</files>
  <action>
Create `src/hooks/useExercises.ts` that encapsulates all exercise data management.

**Hook signature and return type:**
```typescript
export function useExercises(): {
  exercises: Exercise[];
  isLoading: boolean;
  error: string | null;
  refresh: () => Promise<void>;
}
```

**Data loading strategy (cache-first, then network):**
1. On mount (useEffect with empty deps), call `loadExercises()`
2. `loadExercises()`:
   a. Set isLoading = true
   b. Try `getCachedExercises()` from cache.ts. If cache hit, set exercises immediately and set isLoading = false (user sees data fast)
   c. Try `exercises.getExercises()` from the exercises service. If success, set exercises with fresh data and call `setCachedExercises()` to update cache
   d. If network fetch fails AND no cache was loaded, set error message
   e. Set isLoading = false at the end regardless

**Sorting (LOCKED -- user decision):**
The hook must sort exercises BEFORE returning them:
- User exercises first (is_system === false), then system exercises (is_system === true)
- Alphabetical by name within each group (case-insensitive: use `localeCompare`)
- This sort order is ALWAYS applied, regardless of any search or filter state that callers may apply later

Implement a `sortExercises(data: Exercise[]): Exercise[]` helper function inside the file.

**Refresh function:**
Expose `refresh` function that re-runs `loadExercises()` (for pull-down or foreground refresh in future phases).

**Important:**
- Use `.ts` extension (not .tsx) -- this hook has no JSX
- Import `exercises` from `@/services/exercises` (the service object, not individual functions)
- Import `getCachedExercises`, `setCachedExercises` from `@/lib/cache`
- Import `Exercise` type from `@/types/database`
- Do NOT add search or filter logic inside this hook -- callers (the picker modal) will handle filtering
  </action>
  <verify>
   - `npx tsc --noEmit` passes
   - Hook exports `useExercises` function
   - Sort logic: user exercises first, then system, alphabetical within each
  </verify>
  <done>
   - useExercises hook loads from cache first, then network
   - Exercises are pre-sorted per the locked decision
   - Refresh function available for cache invalidation
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CategoryChips and ExerciseListItem components</name>
  <files>src/components/CategoryChips.tsx, src/components/ExerciseListItem.tsx</files>
  <action>
**CategoryChips.tsx:**

Create a horizontal scrollable category filter component.

Props interface:
```typescript
interface CategoryChipsProps {
  selectedCategory: string;
  onSelectCategory: (category: string) => void;
}
```

Export two category constants:
- `CATEGORIES = ['All', 'Chest', 'Back', 'Shoulders', 'Legs', 'Arms', 'Core', 'Other'] as const` -- for filter chips (includes "All")
- `FORM_CATEGORIES = ['Chest', 'Back', 'Shoulders', 'Legs', 'Arms', 'Core', 'Other'] as const` -- for create form dropdown (excludes "All")

NO Cardio in either list -- per user decision (Cardio dropped, DB constraint excludes it).

Implementation:
- Use `ScrollView` with `horizontal` and `showsHorizontalScrollIndicator={false}` (NOT FlatList -- only 8 fixed items)
- Each chip is a `Pressable` with pill shape (borderRadius: theme.radii.full)
- Selected chip: `backgroundColor: theme.colors.accent`, `color: theme.colors.textPrimary`
- Unselected chip: `backgroundColor: theme.colors.bgElevated`, `color: theme.colors.textSecondary`
- Chip min height: 36px. Horizontal padding: theme.spacing.md. Gap between chips: theme.spacing.sm
- Use `getStyles(theme)` pattern (reference TextInputField.tsx for established pattern)

**ExerciseListItem.tsx:**

Create a single exercise row component for the FlatList.

Props interface:
```typescript
interface ExerciseListItemProps {
  exercise: Exercise;
  isDisabled: boolean;
  onPress: (exercise: Exercise) => void;
}
```

Export a constant for FlatList getItemLayout:
```typescript
export const ITEM_HEIGHT = 60;
```

Implementation:
- Row is a `Pressable`. If `isDisabled`, apply `opacity: 0.5` and disable press
- Layout: flexDirection 'row', alignItems 'center', justifyContent 'space-between'
- Left side (flex: 1): exercise name (bold, 15px, textPrimary) + category below (12px, textMuted) with gap: 2
- Right side: If exercise is user-created (is_system === false), show green "CUSTOM" badge pill
- Badge styling per RESEARCH.md: fontSize 10, fontWeight semibold, uppercase, letterSpacing 0.3, paddingHorizontal 10, paddingVertical 5, borderRadius full, backgroundColor theme.colors.success, color '#18181b', overflow 'hidden'
- Row padding: paddingHorizontal theme.spacing.md, paddingVertical theme.spacing.sm
- Fixed total height of 60px (ITEM_HEIGHT constant) for FlatList getItemLayout optimization
- Use `getStyles(theme)` pattern
  </action>
  <verify>
   - `npx tsc --noEmit` passes
   - CategoryChips exports CATEGORIES and FORM_CATEGORIES constants (no Cardio in either)
   - ExerciseListItem exports ITEM_HEIGHT constant (60)
   - Both components use getStyles(theme) pattern
  </verify>
  <done>
   - CategoryChips renders horizontal scrollable pills with single-select
   - ExerciseListItem renders exercise name + category with optional CUSTOM badge and disabled state
   - Both components use theme tokens via useTheme() and getStyles(theme)
   - ITEM_HEIGHT exported for FlatList optimization
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes for the entire project
- All three new files exist and export correctly
- No Cardio in category constants
- Exercise sort order: user first, system second, alphabetical within
- ITEM_HEIGHT = 60 exported from ExerciseListItem
</verification>

<success_criteria>
- useExercises hook provides cache-first loading with pre-sorted exercises
- CategoryChips renders 8 horizontal pills (All + 7 categories, no Cardio)
- ExerciseListItem renders exercise rows with name, category, CUSTOM badge, and disabled state
- All components follow established getStyles(theme) pattern
- Ready for ExercisePickerModal assembly (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/03-exercise-library/03-02-SUMMARY.md`
</output>
