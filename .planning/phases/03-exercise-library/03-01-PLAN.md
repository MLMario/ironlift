---
phase: 03-exercise-library
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/cache.ts
  - src/services/exercises.ts
autonomous: true

must_haves:
  truths:
    - "Exercise service exports all 10 CRUD methods matching ExercisesService interface"
    - "Cache utilities can store and retrieve Exercise[] from AsyncStorage"
    - "Exercise service is a direct port of the web app with only import path changes"
  artifacts:
    - path: "src/lib/cache.ts"
      provides: "Generic AsyncStorage cache utilities for exercises"
      exports: ["getCachedExercises", "setCachedExercises", "clearExerciseCache"]
    - path: "src/services/exercises.ts"
      provides: "Full exercise CRUD service ported from web app"
      exports: ["exercises"]
  key_links:
    - from: "src/services/exercises.ts"
      to: "@/lib/supabase"
      via: "import"
      pattern: "import.*supabase.*from.*@/lib/supabase"
    - from: "src/services/exercises.ts"
      to: "@/types/database"
      via: "import types"
      pattern: "import type.*Exercise.*ExerciseCategory.*from.*@/types/database"
    - from: "src/lib/cache.ts"
      to: "@react-native-async-storage/async-storage"
      via: "import"
      pattern: "import AsyncStorage from.*async-storage"
---

<objective>
Install AsyncStorage, create the cache utility module, and port the exercise service from the web app.

Purpose: Establish the data layer that all exercise UI depends on -- the service provides Supabase CRUD operations and the cache provides offline read access via AsyncStorage.
Output: Two new files (src/lib/cache.ts, src/services/exercises.ts) and AsyncStorage installed as a dependency.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-exercise-library/03-CONTEXT.md
@.planning/phases/03-exercise-library/03-RESEARCH.md
@src/types/database.ts
@src/types/services.ts
@src/lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install AsyncStorage and create cache utilities</name>
  <files>src/lib/cache.ts</files>
  <action>
1. Install AsyncStorage:
   ```
   npx expo install @react-native-async-storage/async-storage
   ```
   This is included in Expo Go -- zero native linking needed.

2. Create `src/lib/cache.ts` with these exports:
   - `getCachedExercises(): Promise<Exercise[] | null>` -- reads from AsyncStorage key `ironlift:exercises`, returns parsed JSON or null on miss/error
   - `setCachedExercises(exercises: Exercise[]): Promise<void>` -- writes JSON-serialized exercises to AsyncStorage
   - `clearExerciseCache(): Promise<void>` -- removes the exercises cache key

   Use a single cache key constant: `const CACHE_KEY_EXERCISES = 'ironlift:exercises'`

   All functions must wrap AsyncStorage calls in try/catch and fail silently (cache is best-effort). Log errors via console.error but never throw.

   Import Exercise type from `@/types/database`.

   Do NOT add cache expiry timestamps. Do NOT add a generic cache wrapper -- keep it specific to exercises for now. Future phases will extend this module with their own keys (templates, history).
  </action>
  <verify>
   - `npx tsc --noEmit` passes with no errors in cache.ts
   - AsyncStorage appears in package.json dependencies
  </verify>
  <done>
   - cache.ts exports getCachedExercises, setCachedExercises, clearExerciseCache
   - AsyncStorage is installed
  </done>
</task>

<task type="auto">
  <name>Task 2: Port exercise service from web app</name>
  <files>src/services/exercises.ts</files>
  <action>
Port the web app's exercise service from:
`C:/Users/MarioPC/Apps/exercise_tracker_app/packages/shared/src/services/exercises.ts`

This is a near-direct copy. Change ONLY the import paths:
- `import { supabase } from '../lib/supabase'` becomes `import { supabase } from '@/lib/supabase'`
- `import type { Exercise, ExerciseCategory } from '../types/database'` becomes `import type { Exercise, ExerciseCategory } from '@/types/database'`
- `import type { ExercisesService, ServiceResult, ServiceError, UpdateExerciseParams, UpdateExerciseResult, ExerciseDependencies } from '../types/services'` becomes `import type { ... } from '@/types/services'`

ALL function bodies stay IDENTICAL. Do not refactor, optimize, or change any logic. The web app service has been tested and works correctly. Port it as-is.

The service exports an `exercises` object implementing the `ExercisesService` interface with all 10 methods:
- getExercises
- getExercisesByCategory
- getExercisesWithLoggedData
- createExercise
- deleteExercise
- exerciseExists
- getCategories (returns hardcoded array: ['Chest', 'Back', 'Shoulders', 'Legs', 'Arms', 'Core', 'Other'] -- NO Cardio per user decision)
- updateExercise
- getUserExercises
- getExerciseDependencies

Important: Do NOT change `getCategories()` return value. It returns the 7 categories that match the database constraint. Cardio is explicitly excluded per user decision in CONTEXT.md.
  </action>
  <verify>
   - `npx tsc --noEmit` passes with no type errors
   - exercises.ts exports the `exercises` object with all 10 methods
   - Import paths use `@/lib/supabase`, `@/types/database`, `@/types/services`
   - No logic changes from the web app source
  </verify>
  <done>
   - src/services/exercises.ts exists with all 10 CRUD methods
   - TypeScript compilation succeeds
   - Service matches ExercisesService interface contract
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes for the entire project
- AsyncStorage is in package.json
- src/lib/cache.ts and src/services/exercises.ts exist
- No Cardio in getCategories() return value
</verification>

<success_criteria>
- Exercise service is a faithful port of the web app's exercises.ts with only import path changes
- Cache utilities provide get/set/clear for exercise data via AsyncStorage
- Both files compile without type errors
- Foundation is ready for useExercises hook (Plan 02) to consume
</success_criteria>

<output>
After completion, create `.planning/phases/03-exercise-library/03-01-SUMMARY.md`
</output>
