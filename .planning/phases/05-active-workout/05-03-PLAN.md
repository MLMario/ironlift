---
phase: 05-active-workout
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ProgressRing.tsx
  - src/components/RestTimerBar.tsx
  - src/components/ConfirmationModal.tsx
  - src/components/ResumeWorkoutModal.tsx
autonomous: true

must_haves:
  truths:
    - "Progress ring shows completed/total sets as a circular SVG indicator"
    - "Rest timer bar shows countdown with progress fill and +/-10s buttons"
    - "Confirmation modal blocks interaction until user responds"
    - "Resume workout modal shows template name and time since start"
  artifacts:
    - path: "src/components/ProgressRing.tsx"
      provides: "Circular progress ring SVG component"
      exports: ["ProgressRing"]
    - path: "src/components/RestTimerBar.tsx"
      provides: "Inline timer bar with progress and adjustment buttons"
      exports: ["RestTimerBar"]
    - path: "src/components/ConfirmationModal.tsx"
      provides: "Reusable confirmation modal for finish/cancel/template update"
      exports: ["ConfirmationModal"]
    - path: "src/components/ResumeWorkoutModal.tsx"
      provides: "Dashboard overlay for crash recovery resume prompt"
      exports: ["ResumeWorkoutModal"]
  key_links:
    - from: "src/components/ProgressRing.tsx"
      to: "react-native-svg"
      via: "Svg, Circle components for ring rendering"
      pattern: "import.*from.*react-native-svg"
    - from: "src/components/RestTimerBar.tsx"
      to: "src/theme/tokens.ts"
      via: "Theme colors for progress fill gradient"
      pattern: "useTheme"
---

<objective>
Build four small, reusable UI components that the workout screen will compose: ProgressRing (SVG circular indicator), RestTimerBar (inline timer with progress), ConfirmationModal (reusable for finish/cancel/template update), and ResumeWorkoutModal (crash recovery prompt on dashboard).

Purpose: These are standalone presentational components with no business logic. Building them independently ensures they can be tested and styled before integration.
Output: Four component files in src/components/
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-active-workout/05-CONTEXT.md
@.planning/phases/05-active-workout/05-RESEARCH.md
@src/theme/tokens.ts
@src/components/RestTimerInline.tsx
@src/components/ExerciseEditorCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressRing and RestTimerBar components</name>
  <files>
    src/components/ProgressRing.tsx
    src/components/RestTimerBar.tsx
  </files>
  <action>
    1. Create `src/components/ProgressRing.tsx`:
       - Import Svg, Circle from react-native-svg
       - Props: `{ completed: number, total: number, size?: number }` (size defaults to 40)
       - Constants: RADIUS=16, CIRCUMFERENCE=2*PI*RADIUS, STROKE_WIDTH=3
       - Progress calculation: `total > 0 ? completed / total : 0`
       - Stroke dash offset: `CIRCUMFERENCE * (1 - progress)`
       - Background circle: fill=none, stroke=theme.colors.bgElevated, strokeWidth=3
       - Progress arc: fill=none, stroke=(isComplete ? theme.colors.success : theme.colors.accent), strokeWidth=3, strokeLinecap="round", strokeDasharray=CIRCUMFERENCE, strokeDashoffset=offset, rotation=-90, origin=center
       - Center text: completed/total count (e.g., "3/5") using a Text component overlaid via absolute positioning, fontSize=9, fontFamily=mono
       - Use useTheme() for colors, getStyles(theme) pattern

    2. Create `src/components/RestTimerBar.tsx`:
       - Different from RestTimerInline (template editor) -- this is for ACTIVE workout with live countdown
       - Props: `{ remainingSeconds: number, totalSeconds: number, isActive: boolean, onAdjust: (delta: number) => void }`
       - Layout: horizontal row `[-10s] [progress bar with MM:SS overlay] [+10s]`
       - Progress bar: 8px height (per research recommendation), width fills available space
       - Progress fill: percentage = remainingSeconds/totalSeconds * 100, uses theme.colors.accent color
       - MM:SS text overlay centered on the progress bar (absolute positioned)
       - When isActive=false: show the bar at 100% fill with the exercise's default rest time displayed
       - When isActive=true: show countdown with shrinking fill
       - -10s and +10s buttons: 44px min tap targets, same styling as RestTimerInline buttons
       - Format time: `Math.floor(seconds/60):${(seconds%60).toString().padStart(2,'0')}`
       - Use useTheme() for colors, getStyles(theme) pattern
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - ProgressRing.tsx exports ProgressRing component
    - RestTimerBar.tsx exports RestTimerBar component
    - Both use react-native-svg (ProgressRing) and useTheme() (both)
  </verify>
  <done>
    - ProgressRing renders a circular SVG with completed/total display
    - RestTimerBar shows live countdown with progress fill and adjustment buttons
    - Both components follow getStyles(theme) pattern
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ConfirmationModal and ResumeWorkoutModal components</name>
  <files>
    src/components/ConfirmationModal.tsx
    src/components/ResumeWorkoutModal.tsx
  </files>
  <action>
    1. Create `src/components/ConfirmationModal.tsx`:
       - A reusable modal for all workout confirmations (finish, cancel, template update)
       - Props:
         ```typescript
         interface ConfirmationModalProps {
           visible: boolean;
           title: string;
           message: string;
           secondaryMessage?: string;
           confirmLabel: string;
           cancelLabel: string;
           confirmVariant: 'primary' | 'danger';
           dismissOnOverlayPress?: boolean; // defaults true
           onConfirm: () => void;
           onCancel: () => void;
         }
         ```
       - Uses React Native `Modal` with `transparent` and `animationType="fade"`
       - Dark overlay (rgba(0,0,0,0.6))
       - Centered card: bgSurface background, rounded corners (radii.lg), padding
       - Title: textPrimary, sizes.lg, bold
       - Message: textSecondary, sizes.base
       - Secondary message (optional): textMuted, sizes.sm, italic
       - Two buttons side by side: Cancel (bgElevated background) and Confirm (accent or danger based on variant)
       - Both buttons: 44px min height, full-width in a row with gap
       - When dismissOnOverlayPress=false: overlay Pressable does NOT call onCancel (for template update modal per locked decision)
       - When dismissOnOverlayPress=true (default): tapping overlay calls onCancel

    2. Create `src/components/ResumeWorkoutModal.tsx`:
       - Dashboard overlay for crash recovery prompt
       - Props:
         ```typescript
         interface ResumeWorkoutModalProps {
           visible: boolean;
           templateName: string;
           startedAt: string; // ISO timestamp
           onResume: () => void;
           onDiscard: () => void;
         }
         ```
       - Uses React Native `Modal` with `transparent` and `animationType="fade"`
       - Dark overlay (same as ConfirmationModal)
       - Centered card with:
         - Title: "Resume Workout?"
         - Template name displayed prominently
         - Time since start: calculate from startedAt to now, display as "started X min ago" or "started X hours ago"
         - Two buttons: "Resume" (accent, primary action) and "Discard" (bgElevated, secondary)
       - Discard has NO confirmation dialog (per locked decision: "no confirmation")
       - Use useTheme() for colors, getStyles(theme) pattern
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - ConfirmationModal.tsx exports ConfirmationModal with all props
    - ResumeWorkoutModal.tsx exports ResumeWorkoutModal
    - Both use RN Modal (not Expo Router modal)
  </verify>
  <done>
    - ConfirmationModal is reusable for finish/cancel/template update with configurable overlay dismissal
    - ResumeWorkoutModal shows template name + time since start with Resume/Discard actions
    - Both follow dark overlay + centered card pattern matching iOS conventions
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` -- all four components type-check
- Each component is self-contained with no business logic
- All components use getStyles(theme) pattern
- ProgressRing uses react-native-svg correctly
- ConfirmationModal supports both dismissible and non-dismissible overlay
</verification>

<success_criteria>
- Four reusable components ready for composition into workout screen
- ProgressRing renders SVG circular progress with completed/total text
- RestTimerBar shows live countdown with adjustment buttons
- ConfirmationModal handles all three modal types (finish, cancel, template update)
- ResumeWorkoutModal shows crash recovery prompt with time since start
</success_criteria>

<output>
After completion, create `.planning/phases/05-active-workout/05-03-SUMMARY.md`
</output>
