---
phase: 05-active-workout
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/WorkoutSetRow.tsx
  - app/workout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Completed set rows appear visually muted without revealing the red delete layer behind"
    - "Rest timer bar shows full configured rest time when timer is inactive"
    - "Rest timer bar resets to full configured rest time after countdown ends"
  artifacts:
    - path: "src/components/WorkoutSetRow.tsx"
      provides: "Done state opacity on inner row content only"
      contains: "styles.rowContentDone"
    - path: "app/workout.tsx"
      provides: "Timer props with rest_seconds fallback when inactive"
      contains: "exercise.rest_seconds"
  key_links:
    - from: "app/workout.tsx"
      to: "RestTimerBar"
      via: "getTimerProps returns exercise.rest_seconds when inactive"
      pattern: "rest_seconds"
---

<objective>
Fix 3 cosmetic/minor UI gaps from Phase 5 UAT round 2:
1. Delete icon becomes visible through completed set rows (opacity leak)
2. Rest timer bar shows 0:00 when inactive instead of full rest time
3. Rest timer bar stays at 0:00 after countdown ends instead of resetting

Purpose: Polish the active workout UI so completed sets and rest timer bars display correctly.
Output: Two targeted file edits that resolve all 3 gaps.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-active-workout/05-UAT-round2.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix opacity leak on completed set rows</name>
  <files>src/components/WorkoutSetRow.tsx</files>
  <action>
The bug: `rowDone` style applies `opacity: 0.6` to the `Animated.View` (`rowOuter`) at line 200-205. Since `rowOuter` slides over the `deleteButtonBehind` layer, making it semi-transparent reveals the red delete button underneath even when the row is not swiped.

Fix approach -- move opacity from the outer container to the inner content:

1. Remove `isDone && styles.rowDone` from the Animated.View (line 204). The rowOuter must stay fully opaque to hide the delete layer.

2. Apply `isDone && styles.rowContentDone` to the inner `row` View (line 207) instead. This View contains all the visible content (set badge, inputs, checkbox) but sits INSIDE the opaque rowOuter, so the delete button stays hidden.

3. In `getStyles`, replace the `rowDone` style definition (lines 302-304) with:
```
rowContentDone: {
  opacity: 0.6,
},
```

This is a targeted rename+move: same visual effect on the content, but the opaque rowOuter continues to fully cover the delete layer behind it.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Visually confirm in the code that:
- Animated.View style array no longer references rowDone or any opacity style
- The inner `row` View has the conditional opacity style applied
  </verify>
  <done>Completed set rows appear muted (60% opacity on content) without revealing the red delete button behind the row.</done>
</task>

<task type="auto">
  <name>Task 2: Fix rest timer bar showing 0 when inactive or after countdown</name>
  <files>app/workout.tsx</files>
  <action>
The bug: `getTimerProps()` (lines 464-478) returns `{ timerRemaining: 0, timerTotal: 0, isTimerActive: false }` when the timer is not active for this exercise. This causes RestTimerBar to show "0:00" with no fill. It should show the exercise's configured rest time as a full bar.

Replace the `getTimerProps` function (lines 464-478) with:

```typescript
function getTimerProps(exerciseIndex: number) {
  const exercise = activeWorkout.exercises[exerciseIndex];
  const restSeconds = exercise.rest_seconds;
  const isActive = isActiveForExercise(exerciseIndex);

  if (isActive && timer.status === 'active') {
    return {
      timerRemaining: timer.remaining,
      timerTotal: timer.duration,
      isTimerActive: true,
    };
  }

  // When inactive (not started, or timer completed/idle):
  // Show the full configured rest time so the bar appears full
  return {
    timerRemaining: restSeconds,
    timerTotal: restSeconds,
    isTimerActive: false,
  };
}
```

This fixes both gap 2 (inactive state shows 0) and gap 3 (timer end state stays at 0). When timer is not active, `remainingSeconds === totalSeconds` so RestTimerBar computes `percentage = 100%` (full bar) and displays `formatTime(totalSeconds)` which shows the configured rest time (e.g., "1:30").
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors.
Verify in the code that getTimerProps returns `exercise.rest_seconds` for both timerRemaining and timerTotal when the timer is not active.
  </verify>
  <done>Rest timer bars display the full configured rest time (full bar) when inactive, and reset to full after countdown ends.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. In WorkoutSetRow.tsx: Animated.View has no opacity-related style; inner row View has conditional opacity
3. In workout.tsx: getTimerProps returns exercise.rest_seconds (not 0) when timer is inactive
</verification>

<success_criteria>
- Completed set rows show muted content without red delete icon bleeding through
- Inactive rest timer bars show the exercise's configured rest time as a full bar
- Rest timer bars reset to full after countdown completes (same codepath as inactive)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-active-workout/05-08-SUMMARY.md`
</output>
