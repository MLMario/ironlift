---
phase: 04-templates-and-dashboard
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SetRow.tsx
  - src/components/RestTimerInline.tsx
  - src/components/ExerciseEditorCard.tsx
autonomous: true

must_haves:
  truths:
    - "Each exercise in the template editor displays a set table with set#, weight, reps, and delete button per row"
    - "User can add sets (copies last set values) and remove sets (minimum 1 set enforced)"
    - "Each exercise displays an inline rest timer with -10s/+10s buttons and MM:SS input"
    - "Each exercise card has a remove button and up/down reorder arrows"
  artifacts:
    - path: "src/components/SetRow.tsx"
      provides: "Single set row with weight/reps inputs and delete button"
      exports: ["SetRow"]
    - path: "src/components/RestTimerInline.tsx"
      provides: "Inline rest timer display with -10s/+10s adjustment"
      exports: ["RestTimerInline"]
    - path: "src/components/ExerciseEditorCard.tsx"
      provides: "Complete exercise editor card combining set table, rest timer, and controls"
      exports: ["ExerciseEditorCard"]
  key_links:
    - from: "src/components/ExerciseEditorCard.tsx"
      to: "src/components/SetRow.tsx"
      via: "renders SetRow for each set"
      pattern: "import.*SetRow"
    - from: "src/components/ExerciseEditorCard.tsx"
      to: "src/components/RestTimerInline.tsx"
      via: "renders RestTimerInline below set table"
      pattern: "import.*RestTimerInline"
---

<objective>
Build the template editor sub-components: SetRow, RestTimerInline, and ExerciseEditorCard.

Purpose: The template editor screen (Plan 04) needs these building blocks to display per-exercise configuration. Building them as standalone components keeps each file focused and testable.

Output: Three reusable components that compose into the exercise editor section of the template editor.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-templates-and-dashboard/04-RESEARCH.md
@src/theme/tokens.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build SetRow and RestTimerInline components</name>
  <files>src/components/SetRow.tsx, src/components/RestTimerInline.tsx</files>
  <action>
  **Part A: SetRow component**

  Create `src/components/SetRow.tsx` -- a single row in the set configuration table.

  Props interface:
  ```typescript
  interface SetRowProps {
    setNumber: number;        // 1-based display number
    weight: number;
    reps: number;
    onWeightChange: (value: number) => void;
    onRepsChange: (value: number) => void;
    onDelete: () => void;
    canDelete: boolean;       // false when this is the last set (minimum 1)
  }
  ```

  Layout: horizontal row with 4 columns:
  1. Set number label (e.g., "1") -- fixed width, textMuted color, centered
  2. Weight TextInput -- numeric keyboard, centered text, monospace font (typography.fontFamilyMono), bgElevated background, rounded corners
  3. Reps TextInput -- same styling as weight
  4. Delete button (trash-outline icon from Ionicons) -- danger color, hidden (opacity 0) when canDelete is false. Min 44px tap target.

  TextInput behavior:
  - `keyboardType="numeric"`
  - Parse input to number on change (default to 0 if NaN)
  - Display "0" not empty string when value is 0
  - `selectTextOnFocus={true}` for easy editing

  Use `getStyles(theme)` pattern with `StyleSheet.create()`. Use `useTheme()` hook.

  **Part B: RestTimerInline component**

  Create `src/components/RestTimerInline.tsx` -- inline rest timer configuration.

  Props interface:
  ```typescript
  interface RestTimerInlineProps {
    seconds: number;          // Current rest time in seconds
    onSecondsChange: (value: number) => void;
  }
  ```

  Layout: horizontal row with 4 elements:
  1. [-10s] button -- Pressable with "-10s" text, decrements by 10, minimum 0 seconds
  2. Visual progress bar -- a View showing the rest time as a proportional fill (relative to a reasonable max like 300s). Bar uses accent color fill on bgElevated background. Fixed height ~8px, flex: 1.
  3. Time display/input -- shows formatted MM:SS (e.g., "1:30" for 90s). Use a TextInput that accepts MM:SS format. On blur, parse the input: if just a number, treat as seconds; if MM:SS format, parse accordingly. Minimum 0 seconds. Centered text, monospace font.
  4. [+10s] button -- Pressable with "+10s" text, increments by 10

  Button styling: bgElevated background, rounded, min 44px tap target, textSecondary color text.

  Time formatting helper (inline in file):
  - `formatTime(seconds: number): string` -- converts 90 to "1:30", 60 to "1:00", 45 to "0:45"
  - `parseTimeInput(input: string): number` -- handles "90" (plain seconds), "1:30" (MM:SS), "1:00", etc. Return minimum 0.

  Use `getStyles(theme)` pattern with `StyleSheet.create()`. Use `useTheme()` hook.
  </action>
  <verify>Run `npx tsc --noEmit` -- zero type errors. Both files export their components and compile cleanly.</verify>
  <done>SetRow renders set#/weight/reps/delete in a row. RestTimerInline renders -10s/bar/MM:SS/+10s in a row. Both use theme tokens, both compile.</done>
</task>

<task type="auto">
  <name>Task 2: Build ExerciseEditorCard component</name>
  <files>src/components/ExerciseEditorCard.tsx</files>
  <action>
  Create `src/components/ExerciseEditorCard.tsx` -- a card for configuring one exercise within the template editor.

  Define editing types at the top of the file (will be used by template editor screen too -- export them):
  ```typescript
  export interface EditingSet {
    set_number: number;
    weight: number;
    reps: number;
  }

  export interface EditingExercise {
    exercise_id: string;
    name: string;
    category: string;
    default_rest_seconds: number;
    sets: EditingSet[];
  }
  ```

  Props interface:
  ```typescript
  interface ExerciseEditorCardProps {
    exercise: EditingExercise;
    index: number;              // 0-based position in exercise list
    totalExercises: number;     // Total number of exercises (for disable up/down)
    onUpdate: (updated: EditingExercise) => void;
    onRemove: () => void;
    onMoveUp: () => void;
    onMoveDown: () => void;
  }
  ```

  Layout (top to bottom):

  **Header row:**
  - Exercise name (bold, textPrimary) + category badge (textMuted, small)
  - Right side controls: up arrow button (chevron-up), down arrow button (chevron-down), remove button (close-circle icon, danger color)
  - Up arrow disabled (opacity 0.3) when index === 0
  - Down arrow disabled when index === totalExercises - 1
  - All buttons: min 44px tap target

  **Set table header:**
  - Labels row: "Set" | "Weight" | "Reps" | "" (for delete column)
  - textMuted color, small font

  **Set rows:**
  - Map over exercise.sets, render `<SetRow>` for each
  - Pass `canDelete={exercise.sets.length > 1}` (minimum 1 set)
  - Handle weight/reps changes by updating the specific set in exercise.sets array, then call `onUpdate` with the modified exercise
  - Handle delete by removing the set from array, renumbering remaining sets (1-based), then call `onUpdate`

  **"Add Set" button:**
  - Full width, accent border, accent text: "+ Add Set"
  - On press: add a new set copying the last set's weight/reps values (or weight=0, reps=10 if no sets). Set number = last set number + 1. Call `onUpdate`.

  **Rest timer:**
  - Render `<RestTimerInline>` below the set table
  - Pass exercise.default_rest_seconds and handle changes via `onUpdate`

  Card styling: bgSurface background, rounded corners (radii.lg), padding md, marginBottom sm. Subtle border (border color).

  Use `getStyles(theme)` pattern with `StyleSheet.create()`. Use `useTheme()` hook. Import SetRow and RestTimerInline.
  </action>
  <verify>Run `npx tsc --noEmit` -- zero type errors. ExerciseEditorCard exports the component plus EditingSet and EditingExercise types.</verify>
  <done>ExerciseEditorCard renders exercise name, set table with add/remove, rest timer, and reorder controls. Exports EditingSet and EditingExercise types for reuse.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. SetRow accepts numeric inputs for weight/reps with delete button
3. RestTimerInline has -10s/+10s buttons and MM:SS display
4. ExerciseEditorCard composes SetRow + RestTimerInline with header controls
5. EditingSet and EditingExercise types are exported from ExerciseEditorCard
6. All components use getStyles(theme) pattern with StyleSheet.create
7. All tap targets are minimum 44px
</verification>

<success_criteria>
- Three components compile cleanly and follow project styling conventions
- Set table supports add/remove with minimum 1 set enforcement
- Rest timer supports -10s/+10s and MM:SS input/display
- Exercise card has up/down reorder arrows and remove button
- Editing types (EditingSet, EditingExercise) exported for template editor consumption
</success_criteria>

<output>
After completion, create `.planning/phases/04-templates-and-dashboard/04-02-SUMMARY.md`
</output>
