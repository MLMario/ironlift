---
phase: 04-templates-and-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/DashboardHeader.tsx
  - src/components/TemplateCard.tsx
  - src/components/TemplateGrid.tsx
  - app/index.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard displays user's workout templates as cards in a 2-column grid"
    - "Dashboard header shows IronLift brand text and settings gear icon"
    - "Each template card shows template name, exercise preview list, and Start button"
    - "Swiping left on a template card reveals Edit and Delete actions"
    - "User can delete a template via swipe-to-reveal with confirmation dialog"
    - "'+' card at end of grid opens the template editor in create mode"
    - "Empty state shows encouraging message when no templates exist"
  artifacts:
    - path: "src/components/DashboardHeader.tsx"
      provides: "Sticky header with brand text and gear icon"
      exports: ["DashboardHeader"]
    - path: "src/components/TemplateCard.tsx"
      provides: "Swipeable template card with exercise preview and Start button"
      exports: ["TemplateCard"]
    - path: "src/components/TemplateGrid.tsx"
      provides: "2-column FlatList grid with + card appended"
      exports: ["TemplateGrid"]
    - path: "app/index.tsx"
      provides: "Dashboard screen assembling header, grid, loading, and empty states"
  key_links:
    - from: "app/index.tsx"
      to: "src/hooks/useTemplates.ts"
      via: "useTemplates() for template data"
      pattern: "useTemplates"
    - from: "app/index.tsx"
      to: "src/components/TemplateGrid.tsx"
      via: "renders TemplateGrid"
      pattern: "import.*TemplateGrid"
    - from: "src/components/TemplateCard.tsx"
      to: "react-native-gesture-handler/ReanimatedSwipeable"
      via: "swipe-to-reveal actions"
      pattern: "ReanimatedSwipeable"
    - from: "app/index.tsx"
      to: "/template-editor"
      via: "router.push for create/edit"
      pattern: "router\\.push.*template-editor"
---

<objective>
Build the dashboard screen with template card grid, swipeable actions, and header.

Purpose: The dashboard is the app's central hub. Users see their templates, start workouts, and navigate to the template editor. This plan replaces the Phase 1 placeholder dashboard with the real implementation.

Output: Fully functional dashboard with header, 2-column template grid, swipeable edit/delete, and navigation to template editor.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-templates-and-dashboard/04-RESEARCH.md
@.planning/phases/04-templates-and-dashboard/04-01-SUMMARY.md
@src/theme/tokens.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build DashboardHeader and TemplateCard components</name>
  <files>src/components/DashboardHeader.tsx, src/components/TemplateCard.tsx</files>
  <action>
  **Part A: DashboardHeader**

  Create `src/components/DashboardHeader.tsx` -- the sticky dashboard header.

  Props interface:
  ```typescript
  interface DashboardHeaderProps {
    onSettingsPress: () => void;
  }
  ```

  Layout: horizontal row, vertically centered:
  - Left: "IronLift" brand text (sizes['2xl'], semibold, textPrimary)
  - Right: settings gear icon button (Ionicons "settings-outline", size 24, textSecondary color)
  - Gear button: min 44px tap target, calls `onSettingsPress`

  Styling: bgPrimary background, horizontal padding md, vertical padding sm, bottom border (1px, border color). The header should be rendered above the FlatList (not inside it), making it effectively "sticky" since FlatList scrolls independently.

  **Part B: TemplateCard**

  Create `src/components/TemplateCard.tsx` -- a swipeable template card for the grid.

  Props interface:
  ```typescript
  interface TemplateCardProps {
    template: TemplateWithExercises;
    onEdit: (template: TemplateWithExercises) => void;
    onDelete: (template: TemplateWithExercises) => void;
    onStart: (template: TemplateWithExercises) => void;
  }
  ```

  The card is wrapped in `ReanimatedSwipeable` from `react-native-gesture-handler/ReanimatedSwipeable` for swipe-to-reveal actions.

  **Swipeable right actions:**
  - Import `ReanimatedSwipeable` from `react-native-gesture-handler/ReanimatedSwipeable`
  - Import `Animated, useAnimatedStyle, SharedValue` from `react-native-reanimated` (note: use the Reanimated Animated, NOT RN Animated)
  - `renderRightActions` callback receives `(progress: SharedValue<number>, translation: SharedValue<number>)` -- Reanimated 4 signature with SharedValues
  - Right actions container: two buttons side-by-side (total width ~140px)
    - Edit button: accent background, pencil icon, 70px wide
    - Delete button: danger background, trash icon, 70px wide
  - Use `useAnimatedStyle` with `translation.value` to animate the actions sliding in:
    ```typescript
    const animatedStyle = useAnimatedStyle(() => ({
      transform: [{ translateX: translation.value + 140 }],
    }));
    ```
  - Swipeable props: `rightThreshold={40}`, `friction={2}`, `overshootRight={false}`

  **Card content (inside swipeable):**
  - Card container: bgSurface background, radii.lg, flex: 1
  - Template name: bold, textPrimary, 2-line numberOfLines clamp
  - Exercise preview: show first 2 exercise names as textSecondary text. If more than 2, show "... and N more" in textMuted.
  - "Start" button: full-width at bottom of card, accent background, "Start" text, min 44px height, radii.md
  - Card body is NOT tappable (per user decision) -- only the Start button has onPress
  - Give card a fixed minimum height so cards in the 2-column grid align visually

  **Delete confirmation:**
  - When onDelete is called (from swipe action), the parent (TemplateGrid or Dashboard) handles showing `Alert.alert()` confirmation. The TemplateCard just calls the callback.

  Use `getStyles(theme)` pattern. Use `useTheme()` hook.
  </action>
  <verify>Run `npx tsc --noEmit` -- zero type errors. Both components export correctly. TemplateCard imports ReanimatedSwipeable without errors.</verify>
  <done>DashboardHeader shows brand + gear icon. TemplateCard renders swipeable card with name, exercise preview, Start button, and swipe-to-reveal Edit/Delete actions.</done>
</task>

<task type="auto">
  <name>Task 2: Build TemplateGrid and assemble dashboard screen</name>
  <files>src/components/TemplateGrid.tsx, app/index.tsx</files>
  <action>
  **Part A: TemplateGrid component**

  Create `src/components/TemplateGrid.tsx` -- the 2-column FlatList grid.

  Props interface:
  ```typescript
  interface TemplateGridProps {
    templates: TemplateWithExercises[];
    onEdit: (template: TemplateWithExercises) => void;
    onDelete: (template: TemplateWithExercises) => void;
    onStart: (template: TemplateWithExercises) => void;
    onCreateNew: () => void;
  }
  ```

  Implementation:
  1. Build data array: `[...templates, { id: '__add__' }]` -- append a sentinel "add" item
  2. Use `FlatList` with `numColumns={2}` (HARDCODED, never dynamic)
  3. `columnWrapperStyle={{ gap: theme.spacing.sm }}` for horizontal gap
  4. `contentContainerStyle={{ gap: theme.spacing.sm, padding: theme.spacing.md }}` for vertical gap + outer padding
  5. `renderItem`: if item.id === '__add__', render an "Add Template" card. Otherwise render `<TemplateCard>`.
  6. `keyExtractor`: use item.id

  **Add Template card ("+" card):**
  - Same size as template cards (flex: 1 within the grid column)
  - Dashed border (borderStyle: 'dashed', border color, borderWidth 2)
  - bgPrimary background (slightly different from template cards)
  - Centered content: "+" icon (Ionicons "add", size 32, textMuted) + "New Template" text (textMuted)
  - Full card is tappable (Pressable), calls `onCreateNew`
  - Pressed state: bgSurface background

  **Even column handling:** If total items (templates + add card) is odd and numColumns=2, FlatList handles the last row with a single item taking its flex:1 column width. This is acceptable -- the add card or last template card will be half-width.

  **Part B: Dashboard screen (app/index.tsx)**

  REPLACE the entire Phase 1 placeholder in `app/index.tsx` with the real dashboard.

  The dashboard screen composes: DashboardHeader, TemplateGrid, useTemplates hook, loading state, empty state.

  Implementation:
  1. Imports: SafeAreaView, View, Text, ActivityIndicator, Alert from RN. useRouter from expo-router. useTheme. useTemplates. DashboardHeader, TemplateGrid, TemplateCard components. templates service.
  2. Use `useTemplates()` hook for data: `{ templates, isLoading, error, refresh }`
  3. Keep the logout button (temporary, moved to a simple text button in the header area or below the grid -- it will be replaced in Phase 7 settings). Place it as a simple Pressable at the bottom of the screen or in the settings gear handler.

  **Screen layout (top to bottom):**
  - SafeAreaView with bgPrimary background, flex: 1
  - DashboardHeader with `onSettingsPress` wired to nothing for now (Phase 7). Alternatively, wire it to logout for now as the temporary logout mechanism.
  - Loading state: if isLoading and no templates, show centered ActivityIndicator
  - Error state: if error, show error text with retry option
  - Empty state: if not loading and templates.length === 0, show centered message: "No templates yet. Create your first workout template to get started!" PLUS the TemplateGrid (which always shows the '+' card)
  - Normal state: TemplateGrid with all templates

  **Event handlers:**
  - `onCreateNew`: `router.push('/template-editor')` -- opens editor in create mode
  - `onEdit`: `router.push('/template-editor?templateId=${template.id}')` -- opens editor in edit mode
  - `onDelete`: Show `Alert.alert('Delete Template', 'Delete "${template.name}"?', [{Cancel}, {Delete (destructive) -> call templates.deleteTemplate(id) then refresh()}])`
  - `onStart`: No-op for now (Phase 5). Show a brief alert or do nothing. The Start button exists but won't function until Phase 5.
  - `onSettingsPress`: Wire to `auth.logout()` as temporary logout mechanism (same as current placeholder). Import auth from `@/services/auth`.

  **Critical: Remove the ExercisePickerModal test hookup** from the current placeholder. That was a Phase 3 test. The dashboard no longer needs it.

  Use `getStyles(theme)` pattern with `StyleSheet.create()`.
  </action>
  <verify>
  1. Run `npx tsc --noEmit` -- zero type errors
  2. Run `npx expo start` and verify dashboard renders on device with header and '+' card
  3. Verify tapping '+' card navigates to template editor (still placeholder from Plan 01, that's OK)
  4. Verify logout still works via gear icon
  </verify>
  <done>Dashboard shows IronLift header with gear icon, 2-column template grid with swipeable cards, '+' card for creating templates, empty state message, and delete confirmation dialog. Navigation to template editor works.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Dashboard header shows "IronLift" and gear icon
3. Template grid renders as 2-column layout with spacing
4. '+' card shows with dashed border and "New Template" text
5. Template cards (when templates exist) show name, exercise preview, Start button
6. Swipe left on a card reveals Edit and Delete action buttons
7. Delete shows native confirmation dialog
8. Tapping '+' or Edit navigates to template editor with correct params
9. Empty state shows encouraging message
10. Temporary logout still accessible
</verification>

<success_criteria>
- Dashboard replaces Phase 1 placeholder entirely
- 2-column grid renders correctly with swipeable template cards
- Swipe-to-reveal works (Edit/Delete actions appear on left swipe)
- Navigation to template editor works in both create and edit modes
- Delete template works with confirmation dialog
- Empty state and loading state both render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-templates-and-dashboard/04-03-SUMMARY.md`
</output>
