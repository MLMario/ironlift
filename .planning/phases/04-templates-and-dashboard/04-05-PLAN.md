---
phase: 04-templates-and-dashboard
plan: 05
type: execute
wave: 1
depends_on: [04-04]
files_modified:
  - src/components/TemplateGrid.tsx
  - src/components/TemplateCard.tsx
  - app/index.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Dashboard refreshes to show newly created template after saving from editor modal"
    - "Templates appear under a 'My Templates' section heading on the dashboard"
    - "Create button labeled '+Create' positioned next to the My Templates section title"
    - "Template cards stack vertically in a single column, full width with horizontal padding"
    - "Start button has internal padding within the template card, not touching card edges"
  artifacts:
    - path: "src/components/TemplateGrid.tsx"
      provides: "Single-column template list with section header and +Create button"
    - path: "src/components/TemplateCard.tsx"
      provides: "Full-width swipeable template card with padded Start button"
    - path: "app/index.tsx"
      provides: "Dashboard with refresh-on-focus after modal navigation"
  key_links:
    - from: "app/index.tsx"
      to: "useTemplates refresh()"
      via: "useFocusEffect triggers refresh when screen regains focus"
      pattern: "useFocusEffect.*refresh"
    - from: "src/components/TemplateGrid.tsx"
      to: "section header + create button"
      via: "My Templates heading with +Create Pressable"
      pattern: "My Templates"
---

<objective>
Fix the dashboard layout and refresh issues from UAT gaps 4, 5, 6, 7, and 8.

Purpose: The dashboard currently uses a 2-column grid with a dashed "+" card, doesn't refresh after creating a template, and lacks a section heading. The web app uses a "My Templates" section heading with a "+Create" button next to it, and templates are displayed in a vertical list. The dashboard must also refresh when returning from the template editor modal.

Output: TemplateGrid with single-column layout, section header, +Create button; TemplateCard with full-width layout and padded Start button; Dashboard that refreshes on focus.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-templates-and-dashboard/04-03-SUMMARY.md
@.planning/phases/04-templates-and-dashboard/04-04-SUMMARY.md

Key web app reference:
- Web app dashboard header: `<span class="brand-logo"><span class="iron">Iron</span><span class="factor">Factor</span></span>`
- Web app template section: `<div class="section-header"><h2 class="section-title">My Templates</h2><button class="btn btn-primary btn-sm">+ Create</button></div>`
- Web app section-header CSS: `display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);`
- Web app uses a 2-column mini grid (`templates-mini-grid`), but the USER has decided to override this to single-column vertical stack for the iOS app
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure TemplateGrid to single-column list with section header and +Create button</name>
  <files>src/components/TemplateGrid.tsx</files>
  <action>
Rewrite TemplateGrid.tsx to address UAT gaps 5, 6, and 7:

**Gap 5 - Section heading:** Add a "My Templates" section header at the top of the component. This is a row with "My Templates" text on the left (fontSize: sizes['2xl'], fontWeight: semibold, color: textPrimary) and a "+Create" button on the right. Use flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center'. The section header has marginBottom: spacing.lg.

**Gap 6 - +Create button:** Replace the dashed sentinel "+" card with a "+Create" Pressable button positioned in the section header row. Style it as a small accent button: backgroundColor: accent, borderRadius: radii.md, paddingHorizontal: spacing.md, paddingVertical: spacing.sm. Text: "+ Create" (fontSize: sizes.sm, fontWeight: medium, color: textPrimary). Add pressed state with accentHover background.

**Gap 7 - Single column:** Change from FlatList with numColumns=2 to a simple ScrollView (or FlatList with numColumns=1). Remove the sentinel item pattern entirely. Remove columnWrapperStyle. Set contentContainerStyle to { gap: spacing.sm, paddingHorizontal: spacing.md, paddingBottom: spacing.md }. Each card renders at full width.

Remove the AddCardSentinel type, isAddCard function, and the dashed add card rendering. Remove the CARD_MIN_HEIGHT import since it was used for 2-column grid alignment.

The component structure should be:
```
<View>
  <View style={sectionHeader}>  // "My Templates" + "+Create"
    <Text>My Templates</Text>
    <Pressable onPress={onCreateNew}>
      <Text>+ Create</Text>
    </Pressable>
  </View>
  <FlatList
    data={templates}
    numColumns={1}
    renderItem={...}  // renders TemplateCard only, no sentinel
    contentContainerStyle={{ gap: spacing.sm }}
  />
</View>
```

Keep the existing props interface (templates, onEdit, onDelete, onStart, onCreateNew). The section header and FlatList are siblings inside a container View.
  </action>
  <verify>Read src/components/TemplateGrid.tsx and confirm: no numColumns=2, no sentinel item, no dashed add card, "My Templates" text exists, "+ Create" Pressable exists, single column layout.</verify>
  <done>TemplateGrid renders a "My Templates" section heading with "+Create" button and a single-column FlatList of template cards without the dashed sentinel card.</done>
</task>

<task type="auto">
  <name>Task 2: Update TemplateCard for full-width layout with padded Start button, and add dashboard refresh-on-focus</name>
  <files>src/components/TemplateCard.tsx, app/index.tsx</files>
  <action>
**TemplateCard.tsx - Gap 8 (Start button padding):**
The Start button currently spans the full card width edge-to-edge with borderBottomLeftRadius and borderBottomRightRadius. Add internal horizontal margin to the Start button so it doesn't touch card edges:
- Change startButton style: add marginHorizontal: spacing.sm, marginBottom: spacing.sm, borderRadius: radii.md (all corners, not just bottom). Remove borderBottomLeftRadius and borderBottomRightRadius.
- This gives the Start button internal padding within the card.

**TemplateCard.tsx - Gap 7 (full-width adaptation):**
Remove the `export const CARD_MIN_HEIGHT = 180` export and the minHeight from the card style. The card should size itself naturally based on content now that it's full-width. Keep `flex: 1` or remove it since each card is a single item in a single-column list — it doesn't need flex: 1 for grid alignment anymore. Remove flex:1 from swipeableContainer as well if it was only for grid alignment.

**app/index.tsx - Gap 4 (dashboard refresh after modal):**
The dashboard doesn't refresh after creating a template because the template editor calls `router.back()` which returns to the dashboard, but the dashboard's useTemplates hook only loads on initial mount (useEffect with empty deps via useCallback). The dashboard needs to refresh when it regains focus.

Add `useFocusEffect` from `@react-navigation/native` (available via expo-router) to trigger a refresh when the dashboard screen regains focus after returning from the template editor modal:

```typescript
import { useFocusEffect } from 'expo-router';

// Inside DashboardScreen, after the useTemplates hook:
useFocusEffect(
  useCallback(() => {
    refresh();
  }, [refresh])
);
```

This ensures that every time the user navigates back to the dashboard (from template editor, or any other screen), the templates list is refreshed from cache + network. This is a lightweight call — the cache-first strategy means it shows cached data instantly while fetching fresh data in the background.

Remove the empty-state text block that was rendered above the TemplateGrid (the "No templates yet" View). The TemplateGrid component should handle its own empty state internally — when templates.length === 0, TemplateGrid will just show the "My Templates" header with the "+Create" button and no cards below it, which is a natural empty state.
  </action>
  <verify>Read src/components/TemplateCard.tsx and confirm: no CARD_MIN_HEIGHT export, Start button has margin/padding. Read app/index.tsx and confirm: useFocusEffect import exists, refresh() is called on focus, no standalone empty-state text block above TemplateGrid.</verify>
  <done>Template cards render full-width with a padded Start button, and the dashboard refreshes its template list when returning from the template editor modal.</done>
</task>

</tasks>

<verification>
1. Read src/components/TemplateGrid.tsx — must contain "My Templates" heading and "+ Create" button, must NOT contain numColumns=2, sentinel pattern, or dashed add card
2. Read src/components/TemplateCard.tsx — Start button must have margin/border-radius for internal padding, CARD_MIN_HEIGHT export must be removed
3. Read app/index.tsx — must import and use useFocusEffect to call refresh(), must not have standalone empty state text block
4. Run `npx tsc --noEmit` to confirm no type errors
</verification>

<success_criteria>
- Template grid shows "My Templates" heading with "+Create" button at the top
- Template cards stack vertically in a single column at full width
- Start button has visible padding/margin within the card (not edge-to-edge)
- Dashboard refreshes template list when returning from template editor
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-templates-and-dashboard/04-05-SUMMARY.md`
</output>
