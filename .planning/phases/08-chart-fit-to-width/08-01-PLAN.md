---
phase: 08-chart-fit-to-width
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/components/ChartCard.tsx]
autonomous: false

must_haves:
  truths:
    - "Chart renders all data points within the visible card width (no horizontal scrolling)"
    - "Spacing between points adjusts dynamically based on the number of data points"
    - "Charts with few data points (2-3) still look well-spaced, not cramped"
    - "X-axis labels remain readable without overlap on dense charts (10+ points)"
  artifacts:
    - path: "src/components/ChartCard.tsx"
      provides: "Fit-to-width LineChart with onLayout measurement, adjustToWidth, label thinning"
      contains: "adjustToWidth"
  key_links:
    - from: "chartContainer onLayout"
      to: "chartWidth state"
      via: "handleChartLayout callback sets width"
      pattern: "onLayout.*handleChartLayout"
    - from: "chartWidth state"
      to: "LineChart parentWidth prop"
      via: "passed as parentWidth={chartWidth}"
      pattern: "parentWidth=\\{chartWidth\\}"
    - from: "chartWidth > 0 guard"
      to: "LineChart render"
      via: "conditional render prevents zero-division"
      pattern: "chartWidth > 0"
    - from: "thinLabels function"
      to: "LineChart data prop"
      via: "processes data items to remove overlapping labels"
      pattern: "thinLabels"
---

<objective>
Make charts display all data points within the visible card width instead of scrolling horizontally, using the library's built-in `adjustToWidth` prop with dynamic label thinning for readability.

Purpose: Users see the full trend at a glance without needing to scroll, making progress charts immediately useful on the dashboard.
Output: Modified ChartCard.tsx with fit-to-width rendering and label thinning logic.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-chart-fit-to-width/08-RESEARCH.md
@src/components/ChartCard.tsx
@src/hooks/useChartData.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onLayout width measurement and swap LineChart to fit-to-width props</name>
  <files>src/components/ChartCard.tsx</files>
  <action>
Modify ChartCard.tsx to measure the chart container width and use the library's adjustToWidth prop:

1. Add imports: `useCallback` from react, `LayoutChangeEvent` from react-native.

2. Add width state and layout handler inside ChartCard component:
   ```typescript
   const [chartWidth, setChartWidth] = useState(0);

   const handleChartLayout = useCallback((event: LayoutChangeEvent) => {
     const { width } = event.nativeEvent.layout;
     setChartWidth(width);
   }, []);
   ```

3. Attach `onLayout={handleChartLayout}` to the `chartContainer` View in renderChartArea.

4. Guard LineChart render: only render when `chartWidth > 0`. Show the existing loading placeholder while width is 0.

5. Add a `thinLabels` helper function INSIDE ChartCard.tsx (not in a separate file), placed above the ChartCard component:
   ```typescript
   const INITIAL_SPACING = 10;
   const MIN_LABEL_SPACING = 28;

   function thinLabels(
     items: ChartLineDataItem[],
     containerWidth: number
   ): ChartLineDataItem[] {
     if (items.length <= 1) return items;

     const availableWidth = containerWidth - INITIAL_SPACING;
     const spacingPerPoint = availableWidth / (items.length - 1);

     if (spacingPerPoint >= MIN_LABEL_SPACING) {
       return items;
     }

     const showEveryN = Math.ceil(MIN_LABEL_SPACING / spacingPerPoint);

     return items.map((item, index) => ({
       ...item,
       label: index % showEveryN === 0 || index === items.length - 1
         ? item.label
         : '',
     }));
   }
   ```

6. In the LineChart rendering section, compute thinned data:
   ```typescript
   const thinnedData = thinLabels(data, chartWidth);
   ```
   Pass `thinnedData` to LineChart's `data` prop instead of raw `data`.

7. Change LineChart props -- this is CRITICAL and must be exact:
   - REMOVE: `spacing={40}` (this overrides adjustToWidth -- the root cause of scrolling)
   - REMOVE: `endSpacing={20}` (adjustToWidth auto-sets this to 0)
   - REMOVE: `scrollToEnd` (meaningless when chart fits container)
   - ADD: `adjustToWidth` (boolean, no value needed -- enables auto-spacing)
   - ADD: `parentWidth={chartWidth}` (measured width from onLayout)
   - ADD: `disableScroll` (boolean, no value needed -- prevents horizontal scroll)
   - ADD: `yAxisLabelWidth={0}` (reclaims 10px ghost space from hidden y-axis)
   - CHANGE: `initialSpacing={20}` to `initialSpacing={INITIAL_SPACING}` (use the constant, 10px)

8. For dense charts (50+ data points), conditionally reduce data point radius:
   ```typescript
   const effectiveRadius = data.length > 50 ? 2 : data.length > 30 ? 3 : 4;
   ```
   Pass `dataPointsRadius={effectiveRadius}` instead of the hardcoded `4`.

9. Keep ALL other props unchanged: areaChart, curved, curvature, color, fill colors, opacity, height, hideYAxisText, xAxisLabelTextStyle, xAxisColor, yAxisColor, isAnimated, hideRules, pointerConfig (entire object unchanged).

IMPORTANT: Do NOT pass both `spacing` and `adjustToWidth`. The `spacing` prop MUST be completely removed, not just commented out. The library's internal formula only runs when `spacing` is undefined.

IMPORTANT: The `chartWidth > 0` guard MUST be in place before rendering LineChart. Rendering with parentWidth=0 causes division by zero in the library's spacing calculation.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors in ChartCard.tsx. Confirm:
- No `spacing={40}` in the file
- No `scrollToEnd` in the file
- No `endSpacing` in the file
- `adjustToWidth` appears in the file
- `parentWidth={chartWidth}` appears in the file
- `disableScroll` appears in the file
- `yAxisLabelWidth={0}` appears in the file
- `chartWidth > 0` guard exists before LineChart render
- `thinLabels` function exists
- `handleChartLayout` callback exists with onLayout attachment
  </verify>
  <done>ChartCard.tsx uses adjustToWidth with measured parentWidth, no fixed spacing, no scroll, label thinning for dense charts, and adaptive data point radius. TypeScript compiles without errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify fit-to-width rendering on device</name>
  <what-built>Charts now render all data points within the visible card width using the library's adjustToWidth prop. Fixed spacing and horizontal scrolling have been removed. X-axis labels are thinned on dense charts to prevent overlap. Data point radius scales down for charts with 30+ points.</what-built>
  <how-to-verify>
1. Open the app in Expo Go on the physical iPhone
2. Navigate to the dashboard and scroll to the Charts section
3. For each chart card, verify:
   a. All data points are visible within the card width (no horizontal scroll)
   b. The line chart fills the card width appropriately
   c. Data points are visible and evenly spaced
   d. X-axis labels are readable (not overlapping)
4. If you have a chart with only 2-3 data points:
   - Verify the points spread across the card width (not bunched up on the left)
   - The trend line should span the full width
5. If you have a chart with many data points (10+):
   - Verify labels are thinned (not every point has a visible label)
   - The line and data points are still clearly visible
6. Long-press on a data point to activate the tooltip:
   - Tooltip should appear correctly positioned
   - Tooltip should show the correct value with unit suffix
7. Verify no visual glitches: no clipping at edges, no gaps, no flickering on load
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- ChartCard.tsx contains `adjustToWidth` and `parentWidth={chartWidth}`
- ChartCard.tsx does NOT contain `spacing={40}`, `scrollToEnd`, or `endSpacing={20}`
- Charts render all points within visible width on device (human verified)
- X-axis labels do not overlap on charts with 10+ data points
</verification>

<success_criteria>
1. Chart renders all data points within the visible card width -- no horizontal scrolling on any chart
2. Spacing between points adjusts dynamically -- a 5-point chart has wider spacing than a 30-point chart
3. Charts with few data points (2-3) show a full-width trend line, not bunched to the left
4. X-axis labels are readable on dense charts -- thinned to prevent overlap
5. Tooltip interaction still works correctly (long-press shows value)
</success_criteria>

<output>
After completion, create `.planning/phases/08-chart-fit-to-width/08-01-SUMMARY.md`
</output>
