---
phase: 07-history-and-settings
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/index.tsx
  - src/components/SettingsSheet.tsx
autonomous: true

must_haves:
  truths:
    - "Tapping the gear icon on the dashboard opens a settings bottom sheet overlay"
    - "Bottom sheet shows three menu items: My Exercises, Workout History, Log Out"
    - "Log Out button is styled with danger color and separated from navigation items"
    - "Tapping My Exercises or Workout History dismisses the sheet then navigates to the sub-screen"
    - "Tapping Log Out dismisses the sheet and logs the user out"
    - "Bottom sheet can be dismissed by swiping down or tapping the backdrop"
  artifacts:
    - path: "src/components/SettingsSheet.tsx"
      provides: "Settings bottom sheet with three menu items"
      min_lines: 60
    - path: "app/index.tsx"
      provides: "Dashboard with settings sheet wired to gear icon"
      contains: "SettingsSheet"
  key_links:
    - from: "app/index.tsx"
      to: "src/components/SettingsSheet.tsx"
      via: "SettingsSheet component rendered as sibling of ScrollView"
      pattern: "SettingsSheet"
    - from: "app/index.tsx"
      to: "@gorhom/bottom-sheet"
      via: "SettingsSheet uses bottom-sheet library"
      pattern: "gorhom/bottom-sheet"
---

<objective>
Install @gorhom/bottom-sheet and build the settings bottom sheet overlay on the dashboard, replacing the temporary gear-icon-to-logout wiring with a proper settings menu.

Purpose: This is the navigation entry point for all Phase 7 sub-screens (My Exercises, Workout History). Without the bottom sheet, users cannot reach any settings functionality.
Output: Working settings bottom sheet with three menu items and dismiss-then-navigate behavior.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-history-and-settings/07-CONTEXT.md
@.planning/phases/07-history-and-settings/07-RESEARCH.md
@app/index.tsx
@src/components/DashboardHeader.tsx
@app/_layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @gorhom/bottom-sheet and create SettingsSheet component</name>
  <files>src/components/SettingsSheet.tsx</files>
  <action>
First, install the bottom sheet library:
```bash
pnpm add @gorhom/bottom-sheet@^5.2.8
```

Create `src/components/SettingsSheet.tsx` -- the settings bottom sheet component.

Props interface:
- `visible: boolean` -- whether sheet should be open
- `onClose: () => void` -- called when sheet is dismissed (swipe down or backdrop tap)
- `onMyExercises: () => void` -- callback when My Exercises is tapped
- `onWorkoutHistory: () => void` -- callback when Workout History is tapped
- `onLogout: () => void` -- callback when Log Out is tapped

Implementation:
- Use `@gorhom/bottom-sheet` with `BottomSheet`, `BottomSheetView`, `BottomSheetBackdrop`
- `useRef<BottomSheet>(null)` for the sheet ref
- `snapPoints = useMemo(() => ['35%'], [])` -- enough for 3 menu items plus handle
- `index={-1}` to start closed, use `useEffect` on `visible` prop to `expand()` or `close()`
- `enablePanDownToClose={true}` for swipe-to-dismiss
- `onChange` handler: when index becomes -1 (closed), call `onClose()`
- `backgroundStyle={{ backgroundColor: theme.colors.bgSurface }}`
- `handleIndicatorStyle={{ backgroundColor: theme.colors.textMuted }}`

Backdrop:
```tsx
const renderBackdrop = useCallback(
  (props: any) => (
    <BottomSheetBackdrop
      {...props}
      disappearsOnIndex={-1}
      appearsOnIndex={0}
      opacity={0.6}
    />
  ),
  []
);
```

Menu items (rendered inside BottomSheetView):
- Three rows, each a Pressable with minHeight 52 (comfortable tap target)
- Each row: icon (Ionicons, size 22) + label text (flex: 1) + chevron icon (chevron-forward, size 18, textMuted)
- Row 1: icon "list-outline", label "My Exercises", onPress calls `onMyExercises`
- Row 2: icon "time-outline", label "Workout History", onPress calls `onWorkoutHistory`
- Separator View (height 1, bgColor border, marginVertical spacing.sm)
- Row 3: icon "log-out-outline", label "Log Out", label color = danger, NO chevron, onPress calls `onLogout`

Styles (getStyles pattern with theme):
- menuItem: flexDirection row, alignItems center, paddingHorizontal spacing.md, paddingVertical spacing.sm, minHeight 52
- menuItemPressed: backgroundColor bgElevated (pressed state via Pressable style callback)
- menuIcon: width 32, alignItems center
- menuLabel: flex 1, fontSize base, fontWeight medium, color textPrimary, marginLeft spacing.sm
- menuChevron: color textMuted
- logoutLabel: same as menuLabel but color danger
- separator: height 1, backgroundColor border, marginVertical spacing.sm, marginHorizontal spacing.md
- sheetContent: paddingTop spacing.sm, paddingBottom spacing.lg

**IMPORTANT:** If @gorhom/bottom-sheet crashes or fails to render on Expo Go, immediately fall back to the RN Modal pattern (same as AddChartSheet):
- Use `<Modal visible={visible} transparent animationType="slide" statusBarTranslucent>`
- Overlay Pressable with rgba(0,0,0,0.6) backdrop
- Content View anchored to bottom with borderTopLeftRadius/borderTopRightRadius 16
- Same menu items inside
This fallback should NOT be pre-built -- only implement it if the gorhom library fails.
  </action>
  <verify>
Run `npx expo start` and confirm the app starts without crashes. The component should compile without TypeScript errors:
```bash
npx tsc --noEmit
```
  </verify>
  <done>SettingsSheet component exists with three menu items (My Exercises, Workout History, Log Out), uses @gorhom/bottom-sheet, and compiles without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Wire SettingsSheet into dashboard and replace temporary logout</name>
  <files>app/index.tsx</files>
  <action>
Modify `app/index.tsx` to integrate the SettingsSheet:

1. Add import: `import { SettingsSheet } from '@/components/SettingsSheet';`

2. Add state: `const [settingsOpen, setSettingsOpen] = useState(false);`

3. Replace the `handleSettingsPress` function:
```tsx
function handleSettingsPress() {
  setSettingsOpen(true);
}
```
Remove the `auth` import if it's only used for logout here (check -- it's still needed for logout via the sheet).

4. Add navigation handlers for sheet menu items:
```tsx
function handleMyExercises() {
  setSettingsOpen(false);
  setTimeout(() => router.push('/settings/exercises'), 200);
}

function handleWorkoutHistory() {
  setSettingsOpen(false);
  setTimeout(() => router.push('/settings/history'), 200);
}

function handleLogout() {
  setSettingsOpen(false);
  auth.logout();
}

function handleSettingsClose() {
  setSettingsOpen(false);
}
```

5. Render SettingsSheet as a sibling OUTSIDE the ScrollView but INSIDE the SafeAreaView, after the AddChartSheet and ResumeWorkoutModal:
```tsx
<SettingsSheet
  visible={settingsOpen}
  onClose={handleSettingsClose}
  onMyExercises={handleMyExercises}
  onWorkoutHistory={handleWorkoutHistory}
  onLogout={handleLogout}
/>
```

**CRITICAL:** The SettingsSheet must be rendered OUTSIDE the ScrollView to avoid gesture conflicts. It should be a sibling at the same level as AddChartSheet and ResumeWorkoutModal.

Keep the `auth` import -- it's used by `handleLogout`.
  </action>
  <verify>
Run `npx expo start` on physical device. Tap the gear icon -- the bottom sheet should slide up with three menu items. Tap backdrop or swipe down to dismiss. Tap "Log Out" to verify it logs out. Tap "My Exercises" or "Workout History" -- should navigate to the existing placeholder screens.
  </verify>
  <done>Gear icon opens settings bottom sheet. My Exercises and Workout History navigate to placeholder screens after sheet dismisses. Log Out logs the user out. Sheet dismisses on swipe down and backdrop tap.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. Gear icon opens settings bottom sheet overlay on dashboard
3. Three menu items visible: My Exercises (list icon), Workout History (time icon), Log Out (danger-colored, separated)
4. Tapping My Exercises dismisses sheet then navigates to /settings/exercises
5. Tapping Workout History dismisses sheet then navigates to /settings/history
6. Tapping Log Out dismisses sheet then logs out
7. Swiping down or tapping backdrop dismisses the sheet
8. Bottom sheet does NOT conflict with dashboard ScrollView scrolling
</verification>

<success_criteria>
- Settings bottom sheet opens from gear icon with three menu items
- Navigation to placeholder sub-screens works via dismiss-then-navigate pattern
- Log out works from the sheet
- Sheet is dismissible via swipe and backdrop tap
- No gesture conflicts with dashboard scroll
</success_criteria>

<output>
After completion, create `.planning/phases/07-history-and-settings/07-01-SUMMARY.md`
</output>
