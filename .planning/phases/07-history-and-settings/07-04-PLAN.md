---
phase: 07-history-and-settings
plan: 04
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - app/settings/[workoutId].tsx
  - app/settings/[exerciseId].tsx
autonomous: true

must_haves:
  truths:
    - "Tapping a workout card in History navigates to a read-only Workout Detail screen"
    - "Detail shows template name (or 'Untitled Workout') and full date with year"
    - "Each exercise block has a color-coded category badge"
    - "Set grid shows set number, weight, reps, and status (checkmark or X)"
    - "Exercises are sorted by order, sets by set_number"
    - "Back button returns to History (standard stack pop)"
  artifacts:
    - path: "app/settings/[workoutId].tsx"
      provides: "Workout Detail screen with exercise blocks and set grids"
      min_lines: 100
  key_links:
    - from: "app/settings/[workoutId].tsx"
      to: "src/services/logging.ts"
      via: "logging.getWorkoutLog(workoutId)"
      pattern: "logging\\.getWorkoutLog"
    - from: "app/settings/[workoutId].tsx"
      to: "src/lib/formatters.ts"
      via: "formatDetailDate for header date"
      pattern: "formatDetailDate"
---

<objective>
Build the Workout Detail screen showing a read-only view of a past workout with exercise blocks, category badges, and set grids -- replacing the placeholder exercise detail screen.

Purpose: Users need to drill into a specific past workout to see exactly what exercises, weights, and reps they did. This closes the history browsing loop (timeline -> detail -> back).
Output: Read-only workout detail screen with exercise blocks, color-coded category badges, and set grids.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-history-and-settings/07-CONTEXT.md
@.planning/phases/07-history-and-settings/07-RESEARCH.md
@src/services/logging.ts
@src/types/database.ts
@src/lib/formatters.ts
@app/settings/[exerciseId].tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename route file and build Workout Detail screen</name>
  <files>app/settings/[workoutId].tsx, app/settings/[exerciseId].tsx</files>
  <action>
**Step 1: Rename route file.**

Delete `app/settings/[exerciseId].tsx` and create `app/settings/[workoutId].tsx` in its place. The route parameter changes from `exerciseId` to `workoutId`.

**Step 2: Build the Workout Detail screen in `app/settings/[workoutId].tsx`.**

**Imports:**
- React: useState, useEffect
- RN: View, Text, ScrollView, ActivityIndicator, Pressable, StyleSheet
- SafeAreaView from react-native-safe-area-context
- useRouter, useLocalSearchParams from expo-router
- useTheme, type Theme from @/theme
- Ionicons from @expo/vector-icons
- logging from @/services/logging
- formatDetailDate from @/lib/formatters
- WorkoutLogWithExercises, WorkoutLogExerciseWithSets from @/types/database

**Category colors constant (within the file or as a module-level const):**
```typescript
const CATEGORY_COLORS: Record<string, { bg: string; text: string }> = {
  Chest:     { bg: 'rgba(239, 68, 68, 0.15)',  text: '#ef4444' },
  Back:      { bg: 'rgba(59, 130, 246, 0.15)',  text: '#3b82f6' },
  Shoulders: { bg: 'rgba(249, 115, 22, 0.15)',  text: '#f97316' },
  Legs:      { bg: 'rgba(34, 197, 94, 0.15)',   text: '#22c55e' },
  Arms:      { bg: 'rgba(168, 85, 247, 0.15)',  text: '#a855f7' },
  Core:      { bg: 'rgba(234, 179, 8, 0.15)',   text: '#eab308' },
  Other:     { bg: 'rgba(161, 161, 170, 0.15)', text: '#a1a1aa' },
};
```

**State:**
```typescript
const { workoutId } = useLocalSearchParams<{ workoutId: string }>();
const [workout, setWorkout] = useState<WorkoutLogWithExercises | null>(null);
const [isLoading, setIsLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```

**Load function (useEffect on mount):**
```typescript
useEffect(() => {
  async function load() {
    if (!workoutId) return;
    const { data, error: loadError } = await logging.getWorkoutLog(workoutId);
    if (loadError) {
      setError('Failed to load workout');
    } else {
      setWorkout(data);
    }
    setIsLoading(false);
  }
  load();
}, [workoutId]);
```

**Screen layout:**

```tsx
<SafeAreaView style={styles.container}>
  {/* Header */}
  <View style={styles.header}>
    <Pressable onPress={() => router.back()} style={styles.backButton}>
      <Ionicons name="chevron-back" size={24} color={theme.colors.textPrimary} />
    </Pressable>
    <View style={styles.headerTitleContainer}>
      <Text style={styles.headerTitle} numberOfLines={1}>
        {workout?.template_name || 'Untitled Workout'}
      </Text>
      {workout && (
        <Text style={styles.headerDate}>{formatDetailDate(workout.started_at)}</Text>
      )}
    </View>
    <View style={styles.headerSpacer} />
  </View>

  {/* Content */}
  {isLoading ? (
    <View style={styles.loadingContainer}>
      <ActivityIndicator size="large" color={theme.colors.accent} />
    </View>
  ) : error ? (
    <View style={styles.loadingContainer}>
      <Text style={styles.errorText}>{error}</Text>
    </View>
  ) : workout ? (
    <ScrollView
      style={styles.scrollView}
      contentContainerStyle={styles.scrollContent}
      showsVerticalScrollIndicator={false}
    >
      {workout.workout_log_exercises.map((exercise) => (
        <ExerciseBlock key={exercise.id} exercise={exercise} theme={theme} />
      ))}
    </ScrollView>
  ) : null}
</SafeAreaView>
```

**ExerciseBlock (inline function component or extracted within the file):**

```tsx
function ExerciseBlock({ exercise, theme }: { exercise: WorkoutLogExerciseWithSets; theme: Theme }) {
  const styles = getExerciseStyles(theme);
  const categoryColor = CATEGORY_COLORS[exercise.exercises.category] || CATEGORY_COLORS.Other;

  return (
    <View style={styles.exerciseContainer}>
      {/* Exercise header: name + category badge */}
      <View style={styles.exerciseHeader}>
        <Text style={styles.exerciseName}>{exercise.exercises.name}</Text>
        <View style={[styles.categoryBadge, { backgroundColor: categoryColor.bg }]}>
          <Text style={[styles.categoryText, { color: categoryColor.text }]}>
            {exercise.exercises.category}
          </Text>
        </View>
      </View>

      {/* Set grid header */}
      <View style={styles.setGridHeader}>
        <Text style={[styles.setHeaderCell, styles.setNumberCol]}>Set</Text>
        <Text style={[styles.setHeaderCell, styles.flexCol]}>Weight</Text>
        <Text style={[styles.setHeaderCell, styles.flexCol]}>Reps</Text>
        <Text style={[styles.setHeaderCell, styles.statusCol]}>Status</Text>
      </View>

      {/* Set rows */}
      {exercise.workout_log_sets.map((set) => (
        <View key={set.id} style={styles.setRow}>
          <Text style={[styles.setCell, styles.setNumberCol]}>{set.set_number}</Text>
          <Text style={[styles.setCell, styles.flexCol]}>
            {set.weight > 0 ? `${set.weight} lbs` : 'â€”'}
          </Text>
          <Text style={[styles.setCell, styles.flexCol]}>{set.reps}</Text>
          <View style={styles.statusCol}>
            <Ionicons
              name={set.is_done ? 'checkmark-circle' : 'close-circle'}
              size={18}
              color={set.is_done ? theme.colors.success : theme.colors.textMuted}
            />
          </View>
        </View>
      ))}
    </View>
  );
}
```

**Styles for screen:**
- container: flex 1, backgroundColor bgPrimary
- header: flexDirection row, alignItems center, paddingHorizontal spacing.md, paddingVertical spacing.sm, borderBottomWidth 1, borderBottomColor border
- backButton: minWidth 44, minHeight 44, justifyContent center, alignItems center
- headerTitleContainer: flex 1, alignItems center
- headerTitle: fontSize lg, fontWeight semibold, color textPrimary
- headerDate: fontSize sm, color textSecondary, marginTop 2
- headerSpacer: width 44 (balance the back button)
- loadingContainer: flex 1, justifyContent center, alignItems center
- errorText: fontSize base, color danger, textAlign center
- scrollView: flex 1
- scrollContent: padding spacing.md, paddingBottom spacing.xl

**Styles for ExerciseBlock (getExerciseStyles):**
- exerciseContainer: backgroundColor bgSurface, borderRadius md, padding spacing.md, marginBottom spacing.md, borderWidth 1, borderColor border
- exerciseHeader: flexDirection row, alignItems center, justifyContent space-between, marginBottom spacing.sm
- exerciseName: fontSize base, fontWeight semibold, color textPrimary, flex 1
- categoryBadge: paddingHorizontal spacing.sm, paddingVertical 2, borderRadius sm
- categoryText: fontSize xs, fontWeight medium
- setGridHeader: flexDirection row, alignItems center, paddingVertical spacing.xs, borderBottomWidth 1, borderBottomColor border, marginBottom spacing.xs
- setHeaderCell: fontSize xs, color textMuted, fontWeight medium, textTransform uppercase
- setRow: flexDirection row, alignItems center, paddingVertical 6
- setCell: fontSize sm, color textSecondary, textAlign center
- setNumberCol: width 48, textAlign center
- flexCol: flex 1, textAlign center
- statusCol: width 48, alignItems center
  </action>
  <verify>
1. Delete old file and verify new file is created:
```bash
ls app/settings/
```
Should show `[workoutId].tsx` (not `[exerciseId].tsx`)

2. `npx tsc --noEmit` passes

3. Navigate from History -> tap a workout card -> Workout Detail screen loads with:
   - Template name (or "Untitled Workout") and full date in header
   - Exercise blocks with color-coded category badges
   - Set grids showing set number, weight, reps, status icon
   - Back button returns to History
  </verify>
  <done>Route file renamed from [exerciseId].tsx to [workoutId].tsx. Workout Detail screen shows read-only view with template name, date, exercise blocks with category badges, and set grids with status icons. Back navigation returns to History.</done>
</task>

</tasks>

<verification>
1. `app/settings/[exerciseId].tsx` no longer exists
2. `app/settings/[workoutId].tsx` exists and compiles
3. `npx tsc --noEmit` passes
4. Navigating from History to a workout shows detailed exercise/set breakdown
5. Template name shows in header (or "Untitled Workout" for null)
6. Date shows full format: "Feb 5, 2026"
7. Category badges are color-coded (Chest=red, Back=blue, etc.)
8. Set grid shows set number, weight, reps, status (checkmark/X)
9. Exercises sorted by order, sets by set_number (from service)
10. Back button pops the stack and returns to History
</verification>

<success_criteria>
- Route file correctly renamed and working
- Workout Detail is a complete read-only view of a past workout
- Category badges are color-coded per category
- Set grid displays all set information clearly
- Navigation: History -> Detail -> back to History works
</success_criteria>

<output>
After completion, create `.planning/phases/07-history-and-settings/07-04-SUMMARY.md`
</output>
