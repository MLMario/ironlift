---
phase: 07-history-and-settings
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/MyExercisesList.tsx
  - src/components/CreateExerciseModal.tsx
  - app/settings/exercises.tsx
autonomous: true

must_haves:
  truths:
    - "My Exercises screen shows alphabetical list of user-created exercises with name and category"
    - "Tapping edit icon expands an inline form below the row with name input, category dropdown, cancel/save buttons"
    - "Only one exercise can be expanded for editing at a time"
    - "Edit validates: empty name, invalid characters, duplicate name"
    - "Delete checks dependencies and shows warning with counts before confirmation"
    - "Create exercise modal has name input and category dropdown with same validation"
    - "Empty state shows message and Create Exercise button"
  artifacts:
    - path: "src/components/MyExercisesList.tsx"
      provides: "Exercise list with inline edit accordion and delete flow"
      min_lines: 120
    - path: "src/components/CreateExerciseModal.tsx"
      provides: "Modal for creating new custom exercise"
      min_lines: 60
    - path: "app/settings/exercises.tsx"
      provides: "My Exercises screen replacing placeholder"
      min_lines: 80
  key_links:
    - from: "app/settings/exercises.tsx"
      to: "src/services/exercises.ts"
      via: "exercises.getUserExercises for loading list"
      pattern: "exercises\\.getUserExercises"
    - from: "src/components/MyExercisesList.tsx"
      to: "src/services/exercises.ts"
      via: "exercises.updateExercise, deleteExercise, getExerciseDependencies"
      pattern: "exercises\\.(updateExercise|deleteExercise|getExerciseDependencies)"
    - from: "src/components/CreateExerciseModal.tsx"
      to: "src/services/exercises.ts"
      via: "exercises.createExercise"
      pattern: "exercises\\.createExercise"
---

<objective>
Build the My Exercises screen with alphabetical list, inline edit accordion, delete with dependency warnings, and create modal -- replacing the placeholder exercises screen.

Purpose: Users need to manage their custom exercises (view, edit, delete, create) from the settings area. This is essential for maintaining a personalized exercise library.
Output: Fully functional My Exercises screen with all CRUD operations and validation.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-history-and-settings/07-CONTEXT.md
@.planning/phases/07-history-and-settings/07-RESEARCH.md
@src/services/exercises.ts
@src/types/services.ts
@src/types/database.ts
@src/components/ConfirmationModal.tsx
@app/settings/exercises.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MyExercisesList and CreateExerciseModal components</name>
  <files>src/components/MyExercisesList.tsx, src/components/CreateExerciseModal.tsx</files>
  <action>
**1. Create `src/components/MyExercisesList.tsx`:**

Props:
```typescript
interface MyExercisesListProps {
  exercises: Exercise[];
  onExerciseUpdated: () => void;  // Callback to refresh list after edit/delete
}
```

State:
```typescript
const [expandedId, setExpandedId] = useState<string | null>(null);
const [editName, setEditName] = useState('');
const [editCategory, setEditCategory] = useState<ExerciseCategory>('Chest');
const [editError, setEditError] = useState<string | null>(null);
const [isSaving, setIsSaving] = useState(false);
const [deleteTarget, setDeleteTarget] = useState<Exercise | null>(null);
const [deleteMessage, setDeleteMessage] = useState('');
const [showDeleteModal, setShowDeleteModal] = useState(false);
const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);
```

**Exercise row (non-expanded):**
- View with flexDirection row, alignItems center, paddingVertical spacing.sm, paddingHorizontal spacing.md, borderBottomWidth 1, borderBottomColor border
- Name: Text, fontSize base, fontWeight medium, color textPrimary, flex 1
- Category: Text, fontSize sm, color textSecondary, marginRight spacing.sm
- Edit button: Pressable with Ionicons "create-outline", size 20, color textSecondary, minWidth/minHeight 44
- Delete button: Pressable with Ionicons "trash-outline", size 20, color danger, minWidth/minHeight 44

**Edit icon onPress:**
```typescript
function handleEditPress(exercise: Exercise) {
  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
  if (expandedId === exercise.id) {
    setExpandedId(null);
  } else {
    setExpandedId(exercise.id);
    setEditName(exercise.name);
    setEditCategory(exercise.category);
    setEditError(null);
  }
}
```

Import LayoutAnimation and Platform from react-native. Enable on Android:
```typescript
if (Platform.OS === 'android') {
  UIManager.setLayoutAnimationEnabledExperimental?.(true);
}
```

**Expanded edit form (conditionally rendered when expandedId === exercise.id):**
- Container: paddingHorizontal spacing.md, paddingVertical spacing.sm, backgroundColor bgElevated, borderBottomWidth 1, borderBottomColor border
- Name input: TextInput with value editName, onChangeText setEditName, placeholder "Exercise name", placeholderTextColor textMuted, style: backgroundColor bgPrimary, color textPrimary, borderRadius md, padding spacing.sm, borderWidth 1, borderColor border, fontSize base
- Category dropdown: A Pressable that shows the current category with a chevron-down icon. When pressed, toggles showCategoryDropdown state. When dropdown is open, render a list of category options (from exercises.getCategories()) as Pressable rows below. Tapping an option sets editCategory and closes dropdown.
- Category option row: paddingVertical spacing.xs, paddingHorizontal spacing.sm. Selected option: backgroundColor accent, color textPrimary. Unselected: color textSecondary.
- Error text: if editError, show Text with color danger, fontSize sm, marginTop spacing.xs
- Button row: flexDirection row, gap spacing.sm, marginTop spacing.sm
  - Cancel button: flex 1, backgroundColor bgPrimary, borderRadius md, minHeight 40, centered text "Cancel", color textSecondary
  - Save button: flex 1, backgroundColor accent, borderRadius md, minHeight 40, centered text "Save", color textPrimary, fontWeight semibold. If isSaving, show ActivityIndicator instead.

**handleSave:**
```typescript
async function handleSave() {
  if (!expandedId) return;
  setEditError(null);
  setIsSaving(true);
  const result = await exercises.updateExercise({
    id: expandedId,
    name: editName,
    category: editCategory,
  });
  setIsSaving(false);
  if (result.validationError) {
    switch (result.validationError) {
      case 'EMPTY_NAME': setEditError('Name cannot be empty'); break;
      case 'INVALID_NAME': setEditError('Name can only contain letters, numbers, and spaces'); break;
      case 'DUPLICATE_NAME': setEditError('An exercise with this name already exists'); break;
    }
    return;
  }
  if (result.error) {
    setEditError('Failed to update exercise');
    return;
  }
  setExpandedId(null);
  onExerciseUpdated();
}
```

**handleDelete:**
```typescript
async function handleDeletePress(exercise: Exercise) {
  // Check dependencies first
  const { data: deps } = await exercises.getExerciseDependencies(exercise.id);
  if (deps && (deps.templateCount > 0 || deps.workoutLogCount > 0 || deps.chartCount > 0)) {
    const parts: string[] = [];
    if (deps.templateCount > 0) parts.push(`${deps.templateCount} template${deps.templateCount > 1 ? 's' : ''}`);
    if (deps.workoutLogCount > 0) parts.push(`${deps.workoutLogCount} workout log${deps.workoutLogCount > 1 ? 's' : ''}`);
    if (deps.chartCount > 0) parts.push(`${deps.chartCount} chart${deps.chartCount > 1 ? 's' : ''}`);
    setDeleteMessage(`This exercise is used in ${parts.join(', ')}. Deleting it may affect these items.`);
  } else {
    setDeleteMessage('This action cannot be undone.');
  }
  setDeleteTarget(exercise);
  setShowDeleteModal(true);
}

async function handleDeleteConfirm() {
  if (!deleteTarget) return;
  await exercises.deleteExercise(deleteTarget.id);
  setShowDeleteModal(false);
  setDeleteTarget(null);
  onExerciseUpdated();
}
```

Render ConfirmationModal (imported from @/components/ConfirmationModal) for delete:
```tsx
<ConfirmationModal
  visible={showDeleteModal}
  title={`Delete "${deleteTarget?.name}"?`}
  message={deleteMessage}
  confirmLabel="Delete"
  cancelLabel="Cancel"
  confirmVariant="danger"
  onConfirm={handleDeleteConfirm}
  onCancel={() => { setShowDeleteModal(false); setDeleteTarget(null); }}
/>
```

Render the list using ScrollView with .map() (not FlatList, since this list won't be huge and nesting FlatLists causes issues). Each exercise renders the row + conditionally the edit form.

**2. Create `src/components/CreateExerciseModal.tsx`:**

Props:
```typescript
interface CreateExerciseModalProps {
  visible: boolean;
  onClose: () => void;
  onCreated: () => void;
}
```

Uses RN Modal (transparent, fade animation) with the same overlay/card pattern as ConfirmationModal:
- rgba(0,0,0,0.6) backdrop
- Centered card, maxWidth 340, bgSurface, borderRadius lg, padding lg

Form inside the card:
- Title: "Create Exercise", fontSize lg, fontWeight semibold, color textPrimary
- Name TextInput: same styling as edit form input. Placeholder "Exercise name"
- Category dropdown: same pattern as edit form (Pressable showing current category + chevron, expandable list of options)
- Error text: if error, show in danger color
- Button row: Cancel (bgElevated) + Create (accent)

State: name, category (default 'Chest'), error string, isCreating boolean.

Reset state on modal open via useEffect on `visible`:
```typescript
useEffect(() => {
  if (visible) {
    setName('');
    setCategory('Chest');
    setError(null);
  }
}, [visible]);
```

**handleCreate:**
- Validate: trim name, check not empty, check alphanumeric+space only
- If validation fails, set error message and return
- Call `exercises.createExercise(name.trim(), category)`
- If error and message contains "already exists", show duplicate error
- If generic error, show "Failed to create exercise"
- On success: call onCreated() then onClose()

Overlay press dismisses the modal (calls onClose).
  </action>
  <verify>
```bash
npx tsc --noEmit
```
Verify both components compile without type errors.
  </verify>
  <done>MyExercisesList renders exercise rows with inline edit accordion (LayoutAnimation), delete with dependency check + ConfirmationModal, and proper validation. CreateExerciseModal provides a modal form for creating new exercises with validation.</done>
</task>

<task type="auto">
  <name>Task 2: Build My Exercises screen with header, list, and create button</name>
  <files>app/settings/exercises.tsx</files>
  <action>
Replace the placeholder `app/settings/exercises.tsx` with the full My Exercises screen.

**Imports:**
- React: useState, useEffect, useCallback
- RN: View, Text, Pressable, ActivityIndicator, StyleSheet
- SafeAreaView from react-native-safe-area-context
- useRouter from expo-router
- useTheme, type Theme from @/theme
- Ionicons from @expo/vector-icons
- exercises service from @/services/exercises
- MyExercisesList from @/components/MyExercisesList
- CreateExerciseModal from @/components/CreateExerciseModal
- Exercise type from @/types/database

**State:**
```typescript
const [exerciseList, setExerciseList] = useState<Exercise[]>([]);
const [isLoading, setIsLoading] = useState(true);
const [showCreateModal, setShowCreateModal] = useState(false);
```

**Load function:**
```typescript
const loadExercises = useCallback(async () => {
  const { data } = await exercises.getUserExercises();
  setExerciseList(data || []);
  setIsLoading(false);
}, []);
```

Call on mount: `useEffect(() => { loadExercises(); }, [loadExercises]);`

**Screen layout:**

```tsx
<SafeAreaView style={styles.container}>
  {/* Header */}
  <View style={styles.header}>
    <Pressable onPress={() => router.back()} style={styles.backButton}>
      <Ionicons name="chevron-back" size={24} color={theme.colors.textPrimary} />
    </Pressable>
    <Text style={styles.headerTitle}>My Exercises</Text>
    <Pressable onPress={() => setShowCreateModal(true)} style={styles.addButton}>
      <Ionicons name="add" size={24} color={theme.colors.accent} />
    </Pressable>
  </View>

  {/* Content */}
  {isLoading ? (
    <View style={styles.loadingContainer}>
      <ActivityIndicator size="large" color={theme.colors.accent} />
    </View>
  ) : exerciseList.length === 0 ? (
    <View style={styles.emptyContainer}>
      <Text style={styles.emptyText}>You haven't created any custom exercises yet</Text>
      <Pressable
        style={({ pressed }) => [styles.createButton, pressed && styles.createButtonPressed]}
        onPress={() => setShowCreateModal(true)}
      >
        <Ionicons name="add-circle-outline" size={20} color={theme.colors.textPrimary} />
        <Text style={styles.createButtonText}>Create Exercise</Text>
      </Pressable>
    </View>
  ) : (
    <MyExercisesList
      exercises={exerciseList}
      onExerciseUpdated={loadExercises}
    />
  )}

  <CreateExerciseModal
    visible={showCreateModal}
    onClose={() => setShowCreateModal(false)}
    onCreated={loadExercises}
  />
</SafeAreaView>
```

**Header styles:**
- Same pattern as history screen header: flexDirection row, alignItems center, paddingHorizontal spacing.md, paddingVertical spacing.sm, borderBottomWidth 1, borderBottomColor border
- headerTitle: fontSize xl, fontWeight semibold, color textPrimary, flex 1, textAlign center
- backButton: minWidth 44, minHeight 44, justifyContent center, alignItems center
- addButton: minWidth 44, minHeight 44, justifyContent center, alignItems center

**Empty state styles:**
- emptyContainer: flex 1, justifyContent center, alignItems center, padding spacing.lg
- emptyText: fontSize base, color textSecondary, textAlign center, marginBottom spacing.lg
- createButton: flexDirection row, alignItems center, gap spacing.sm, backgroundColor accent, paddingHorizontal spacing.lg, paddingVertical spacing.sm, borderRadius md, minHeight 44
- createButtonPressed: backgroundColor accentHover
- createButtonText: fontSize base, fontWeight medium, color textPrimary
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Navigate to My Exercises from settings sheet on device
3. If user has custom exercises, they appear in alphabetical list
4. Tapping edit icon expands inline form with name, category, cancel/save
5. Only one exercise can be edited at a time (switching collapses previous)
6. Validation works: empty name, invalid characters, duplicate name
7. Delete shows dependency counts in warning
8. Create modal opens from + button in header (or empty state button)
9. Created exercise appears in the list
10. Back button returns to dashboard
  </verify>
  <done>My Exercises screen fully replaces placeholder with alphabetical list, inline edit accordion with validation, delete with dependency warnings and confirmation, create modal, and empty state.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. My Exercises screen loads user's custom exercises in alphabetical order
3. Edit accordion expands/collapses with animation (LayoutAnimation)
4. Only one exercise expanded at a time
5. Edit validates empty name, invalid characters, duplicate name
6. Save updates exercise and refreshes list
7. Delete checks dependencies and shows warning counts
8. Delete confirmation modal works (reuses ConfirmationModal)
9. Create modal validates and creates new exercise
10. Empty state shows message and Create Exercise button
11. Header has back button and add button
</verification>

<success_criteria>
- My Exercises screen fully replaces placeholder
- All CRUD operations work: list, edit, delete, create
- Validation catches empty names, invalid characters, duplicates
- Delete dependency check shows counts (templateCount, workoutLogCount, chartCount)
- Inline edit accordion is smooth (LayoutAnimation)
- Empty state is user-friendly
</success_criteria>

<output>
After completion, create `.planning/phases/07-history-and-settings/07-03-SUMMARY.md`
</output>
