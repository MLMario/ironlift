---
phase: 06-charts
plan: 04
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified:
  - app/index.tsx
  - src/components/TemplateGrid.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard displays charts section below templates section"
    - "Both templates and charts are in one continuous scrollable page"
    - "User can tap 'Add Chart' to open the add chart sheet"
    - "User can delete a chart from the dashboard via kebab menu"
    - "Charts section is always visible even with no charts (shows empty state)"
    - "Hard limit of 25 charts enforced"
  artifacts:
    - path: "app/index.tsx"
      provides: "Dashboard with both template and chart sections in ScrollView"
      contains: "ChartSection"
    - path: "src/components/TemplateGrid.tsx"
      provides: "Template section that renders as a plain View (no FlatList) for embedding in ScrollView"
      contains: ".map"
  key_links:
    - from: "app/index.tsx"
      to: "src/components/ChartSection.tsx"
      via: "ChartSection import and render"
      pattern: "<ChartSection"
    - from: "app/index.tsx"
      to: "src/components/AddChartSheet.tsx"
      via: "AddChartSheet import and render"
      pattern: "<AddChartSheet"
    - from: "app/index.tsx"
      to: "src/hooks/useCharts.ts"
      via: "useCharts hook call"
      pattern: "useCharts\\(\\)"
---

<objective>
Wire the chart components into the dashboard. Convert the dashboard from using a FlatList-based TemplateGrid to a ScrollView containing both templates and charts sections. Add state management for the Add Chart sheet and chart deletion.

Purpose: This is the final assembly step that makes charts visible and interactive on the dashboard. After this plan, the complete charts feature is functional end-to-end.
Output: Modified dashboard screen and TemplateGrid component, ready for human verification.
</objective>

<execution_context>
@C:\Users\MarioPC\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\MarioPC\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-charts/06-CONTEXT.md
@.planning/phases/06-charts/06-RESEARCH.md
@.planning/phases/06-charts/06-01-SUMMARY.md
@.planning/phases/06-charts/06-02-SUMMARY.md
@.planning/phases/06-charts/06-03-SUMMARY.md

@app/index.tsx (current dashboard - needs modification)
@src/components/TemplateGrid.tsx (current FlatList-based - needs conversion)
@src/components/ChartSection.tsx (from Plan 02)
@src/components/AddChartSheet.tsx (from Plan 03)
@src/hooks/useCharts.ts (from Plan 01)
@src/services/charts.ts (deleteChart, from Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert TemplateGrid and wire dashboard</name>
  <files>src/components/TemplateGrid.tsx, app/index.tsx</files>
  <action>
**Modify `src/components/TemplateGrid.tsx`:**

Convert from FlatList to plain View with .map() so it can be embedded inside a parent ScrollView (per research recommendation -- FlatList nested inside ScrollView causes warnings and gesture conflicts).

Changes:
1. Remove `FlatList` import, keep `View, Text, Pressable, StyleSheet`
2. Replace the `<FlatList>` with a `<View>` containing `templates.map()`:
   ```typescript
   <View style={{ gap: theme.spacing.sm, paddingHorizontal: theme.spacing.md, paddingBottom: theme.spacing.md }}>
     {templates.map((template) => (
       <TemplateCard
         key={template.id}
         template={template}
         onEdit={onEdit}
         onDelete={onDelete}
         onStart={onStart}
       />
     ))}
   </View>
   ```
3. Remove the `renderItem` function (no longer needed)
4. Keep the container View with `flex: 1` -- but REMOVE `flex: 1` since it's now inside a ScrollView (flex: 1 would prevent scrolling). Change to just no flex.
5. Keep the section header exactly as-is (same visual pattern)

**Modify `app/index.tsx` (Dashboard):**

Major changes to wire charts into the dashboard:

1. Add imports:
   - `ScrollView` from react-native
   - `useCharts` from `@/hooks/useCharts`
   - `ChartSection` from `@/components/ChartSection`
   - `AddChartSheet` from `@/components/AddChartSheet`
   - `charts as chartsService` from `@/services/charts`

2. Add chart state and hooks:
   ```typescript
   const { charts: chartList, isLoading: chartsLoading, refresh: refreshCharts } = useCharts();
   const [showAddChart, setShowAddChart] = useState(false);
   ```

3. Add chart handlers:
   ```typescript
   function handleAddChart() {
     setShowAddChart(true);
   }

   function handleCloseAddChart() {
     setShowAddChart(false);
   }

   function handleChartCreated() {
     refreshCharts();
   }

   async function handleDeleteChart(chartId: string) {
     await chartsService.deleteChart(chartId);
     refreshCharts();
   }
   ```

4. Update the useFocusEffect to also refresh charts:
   ```typescript
   useFocusEffect(
     useCallback(() => {
       refresh();       // refresh templates
       refreshCharts(); // refresh charts
     }, [refresh, refreshCharts])
   );
   ```

5. Convert the main render from just `<TemplateGrid>` to a `<ScrollView>` wrapping both sections:
   ```typescript
   <SafeAreaView style={styles.container}>
     <DashboardHeader onSettingsPress={handleSettingsPress} />
     <ScrollView
       style={styles.scrollView}
       contentContainerStyle={styles.scrollContent}
       showsVerticalScrollIndicator={false}
     >
       <TemplateGrid
         templates={templates}
         onEdit={handleEdit}
         onDelete={handleDelete}
         onStart={handleStart}
         onCreateNew={handleCreateNew}
       />
       <ChartSection
         charts={chartList}
         isLoading={chartsLoading}
         onDelete={handleDeleteChart}
         onAddChart={handleAddChart}
         canAddChart={chartList.length < 25}
       />
     </ScrollView>
     <AddChartSheet
       visible={showAddChart}
       onClose={handleCloseAddChart}
       onChartCreated={handleChartCreated}
     />
     <ResumeWorkoutModal ... />
   </SafeAreaView>
   ```

6. Update styles:
   - Add `scrollView: { flex: 1 }`
   - Add `scrollContent: { paddingBottom: spacing.xl }` for bottom breathing room
   - Keep container style as-is

7. Update loading state: Show loading only when BOTH templates AND charts have no data and are loading. Currently the loading guard checks `isLoading && templates.length === 0`. Update to also account for charts -- but keep it simple: if templates are loaded (or cached), show the dashboard even if charts are still loading. ChartSection handles its own loading state internally.

8. The error state should remain focused on templates (the critical data). Charts errors are handled by ChartSection internally.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Check that:
- TemplateGrid uses .map() instead of FlatList
- Dashboard uses ScrollView wrapping both TemplateGrid and ChartSection
- AddChartSheet and ChartSection are both rendered in the dashboard
- useCharts hook is called and data flows to ChartSection
- useFocusEffect refreshes both templates and charts
  </verify>
  <done>Dashboard renders templates and charts in one continuous ScrollView. Add Chart opens the bottom sheet. Delete chart works through kebab menu. Charts section always visible with empty state.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete charts feature: chart creation via bottom sheet (exercise selection, metric/axis radio buttons), chart rendering as line charts with gradient fill on dashboard, chart deletion via kebab menu with confirmation, empty state messaging, 25-chart limit enforcement.</what-built>
  <how-to-verify>
1. Open the app on your device via Expo Go
2. Navigate to the dashboard -- you should see "Progress Charts" section below "My Templates" with empty state message: "No charts configured yet. Add a chart to track your progress on an exercise."
3. Tap "+ Add Chart" -- half-height bottom sheet should slide up from bottom
4. Tap "Select Exercise" -- exercise list should appear grouped by category, showing ONLY exercises you have logged workout data for
5. If you have no workout data, you should see "No exercise data yet"
6. Select an exercise -- returns to form with exercise name shown
7. Verify radio buttons work for Metric (Total Sets / Max Volume) and X-Axis (By Date / By Session)
8. Tap "Add Chart" -- sheet closes, chart appears on dashboard
9. Verify chart shows: title with "Exercise Name -- Metric Type", line chart with blue line and gradient, x-axis labels
10. Tap on data points -- tooltip should show exact value
11. If chart has insufficient data (<2 points), verify "Not enough data to display chart" message
12. Tap the three-dot kebab menu on a chart card -- "Delete" option should appear
13. Tap Delete -- confirmation modal should appear
14. Confirm delete -- chart should disappear
15. Scroll dashboard -- verify templates and charts are in one continuous scroll
16. Verify charts section persists when empty (shows empty state message)
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Dashboard has ScrollView containing TemplateGrid + ChartSection
3. TemplateGrid uses .map() not FlatList (no nested list warnings)
4. ChartSection renders below templates, always visible
5. AddChartSheet opens from "+ Add Chart" button
6. Charts can be created and deleted
7. 25-chart limit enforced (Add Chart button hidden/disabled at limit)
8. useFocusEffect refreshes both templates and charts
</verification>

<success_criteria>
- Dashboard displays both templates and charts in continuous scroll
- Add Chart bottom sheet works end-to-end (select exercise, choose metric/axis, submit)
- Charts render as line charts with smooth curves, accent blue line, gradient fill
- Chart deletion works through kebab menu with confirmation
- Empty state message shown when no charts exist
- 25-chart hard limit enforced
- No FlatList nesting warnings
- Human verification of visual design and functionality on device
</success_criteria>

<output>
After completion, create `.planning/phases/06-charts/06-04-SUMMARY.md`
</output>
